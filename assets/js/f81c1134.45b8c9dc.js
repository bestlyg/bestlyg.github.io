"use strict";(self.webpackChunk_bestlyg_site=self.webpackChunk_bestlyg_site||[]).push([[48130],{77735:n=>{n.exports=JSON.parse('{"archive":{"blogPosts":[{"id":"/web/component-library-style-isolation","metadata":{"permalink":"/blog/web/component-library-style-isolation","source":"@site/blog/web/component-library-style-isolation.mdx","title":"\u7ec4\u4ef6\u5e93\u6837\u5f0f\u9694\u79bb\u65b9\u6848","description":"\u80cc\u666f","date":"2024-07-09T11:31:26.000Z","tags":[],"readingTime":12.315,"hasTruncateMarker":false,"authors":[],"frontMatter":{},"unlisted":false,"nextItem":{"title":"\u5b58\u5728 Peer \u4f9d\u8d56\u65f6\uff0cTypeScript \u548c Pnpm \u4e00\u8d77\u7528\u53ef\u80fd\u51fa\u73b0 bug","permalink":"/blog/web/ts-bug-peer-dep"}},"content":"## \u80cc\u666f\\n\\n\u73b0\u9636\u6bb5\u6709\u540c\u5b66\u53cd\u9988\u5728\u4e00\u4e2a\u5b50\u5e94\u7528\u4e2d\uff0c\u540c\u65f6\u4f7f\u7528\u591a\u4e2a\u7248\u672c\u7684\u76f8\u540cM4B\u7ec4\u4ef6\u65f6\uff0c\u4f1a\u4ea7\u751f\u6837\u5f0f\u51b2\u7a81\u95ee\u9898\uff0c\u5bfc\u81f4\u6837\u5f0f\u9519\u4e71\uff0c\u591a\u6570\u60c5\u51b5\u5b58\u5728\u4e8e\u5f53\u524d\u5b50\u5e94\u7528\u5b89\u88c5\u4e86A@2.0.0\u548cB@1.0.0\uff0c\u4f46\u662fB@1.0.0\u53c8\u5f3a\u4f9d\u8d56A@1.0.0\uff0c\u9700\u8981\u5c3d\u65e9\u89e3\u51b3\u6b64\u95ee\u9898\u3002\\n\\n## \u65b9\u6848\u6c47\u603b\\n\\n### \u65b9\u68481 \u2014\u2014 \u57fa\u4e8ehash\u7248\u672c\u53f7\\n\\n\u4f9d\u8d56package.json\u4e2d\u7684\u552f\u4e00\u6027\uff0c\u901a\u8fc7\u5728\u6837\u5f0f\u4e2d\u589e\u52a0\u4e00\u4e2ahashed-version\\n\\n#### \u8001\u4ee3\u7801\\n\\n```css\\n.m4b-button {\\n    ...\\n}\\n```\\n\\n#### \u65b0\u4ee3\u7801\\n\\n##### \u6ce8\u5165\u65b9\u5f0f1\\n\\n\u53d7\u9650\u4e8earco\u7684\u6784\u5efa\u5de5\u5177\u65e0\u6cd5\u5bf9\u9759\u6001\u53d8\u91cf\u66ff\u6362\uff0c\u53ea\u80fd\u4f7f\u7528\u65b9\u68482\u4e2d\u7684token\u6ce8\u5165\u811a\u672c\u8fdb\u884c\u6279\u91cf\u5237\u65b0\\n\\n```css\\n// old\\n.m4b-button {\\n    height: 20px;\\n}\\n```\\n\\n```js\\n// new\\n@import \'./token.less\';\\n.m4b-button[data-v=~\'@{hashed-version}\'] {\\n    ...\\n}\\nimport { HashedVersion } from \'./token.ts\';\\nfunction Button() {\\n    return <button class=\\"m4b-button\\" data-v={HashedVersion} />\\n}\\n```\\n\\n##### \u6ce8\u5165\u65b9\u5f0f2\\n\\n\u540e\u671f\u66f4\u6362\u6784\u5efa\u811a\u672c\u540e\u53ef\u4ee5\u901a\u8fc7\u81ea\u52a8\u8bfb\u53d6\u7684\u65b9\u5f0f\u6ce8\u5165\u53d8\u91cf\uff0c\u4e0d\u9700\u8981\u589e\u52a0\u6587\u4ef6\u3002\\n```less\\n// less\u53ef\u4ee5\u6253\u901anode\u4e16\u754c\uff0c\u53ef\u4ee5\u4f7f\u7528@less-plugins/get-hashed-version\\n// \u589e\u52a0getHashedVersion\u51fd\u6570\u81ea\u52a8\u83b7\u53d6\u5f53\u524dless\u6587\u4ef6\u6700\u8fd1\u7684package.json\u6587\u4ef6\u4e2d\u7684hashed-version\\n@m4b-button-version: getHashedVersion();\\n.m4b-button[data-v=~\'@{hashed-version}\'] {\\n    ...\\n}\\n```\\n\\n```js\\nfunction Button() {\\n    // \u5229\u7528\u5168\u5c40\u9759\u6001\u503c\u66ff\u6362\uff0c\u6253\u5305\u5b8c\u540e\u81ea\u52a8\u6ce8\u5165\\n    return <button class=\\"m4b-button\\" data-v={process.env.M4B_BUTTON_HASHED_VERSION} />\\n}\\n```\\n\\n#### \u4f18\u70b9\\n\\n1. \u5728\u4e0d\u540c\u7248\u672c\u4e4b\u95f4\u80fd\u591f\u4fdd\u8bc1\u5b8c\u5168\u9694\u79bb\uff0c\u4e00\u4e2a\u7248\u672c\u7684\u6837\u5f0f\uff0c\u53ea\u4f1a\u5f71\u54cd\u4e00\u4e2a\u7248\u672c\u3002\\n1. \u975e\u5e38\u9002\u7528\u4e8e\u65b0\u7ec4\u4ef6\\n\\n#### \u7f3a\u70b9\\n\\n1. \u73b0\u9636\u6bb5M4B\u6837\u5f0f\u4e2d\u5b58\u5728\u90e8\u5206\u6837\u5f0f\u4e0d\u89c4\u8303\u7684\u95ee\u9898\uff0c\u9700\u8981\u6539\u9020\uff0c\u6539\u9020\u6210\u672c\u5173\u8054\u6837\u5f0f\u89c4\u8303\u7a0b\u5ea6\uff0c\u4e00\u6b21\u6027\u6539\u9020\u5b8c\u540e\u540e\u7eed\u4e0d\u9700\u8981\u518d\u6b21\u6539\u9020\u3002\\n1. \u5bf9\u4e8e\u73b0\u6709\u6837\u5f0f\uff0c\u5982\u679c\u4e1a\u52a1\u4ed3\u5e93\u4e2d\u5b58\u5728\u6837\u5f0f\u8986\u76d6\uff0c\u53ef\u80fd\u4f1a\u53d7\u5230\u56e0\u4e3a\u6743\u91cd\u5bfc\u81f4\u7684\u4e0d\u751f\u6548\u95ee\u9898\u3002\\n1. \u8001\u7684\u6837\u5f0f\u8986\u76d6\u4f9d\u65e7\u5b58\u5728\\n1. \u7528\u6237\u611f\u77e5\u7ec4\u4ef6\u5f00\u53d1\u8005\u4e5f\u611f\u77e5\\n1. tailwind\u7684\u6837\u5f0f\u56e0\u4e3a\u6743\u91cd\u95ee\u9898\u53ef\u80fd\u65e0\u6cd5\u751f\u6548\\n1. \u8001\u7248\u672carco\u4e0d\u652f\u6301\u5c5e\u6027\u900f\u4f20\uff0c\u65e0\u6cd5\u652f\u6301data-v\\n1. \u4e00\u65e6\u5305\u542bdata-v\uff0c\u5c31\u610f\u5473\u7740tailwind\u7684\u6743\u91cd\u4e0d\u4f1a\u751f\u6548\\n  1. \u89e3\u51b3\u65b9\u6848\uff1a@layer css\\n1. \u7ec4\u4ef6\u4e00\u5b9a\u8981\u652f\u6301data-v\u4f20\u53c2\\n  1. @arco-design/web-react\u4ece2.38.1\u5f00\u59cb\u624d\u652f\u6301\u3002\\n\\n#### \u65b9\u68481.1\\n\\n\u6837\u5f0f\u5168\u90e8\u91cd\u6784\u6210\u5e26hash\u524d\u7f00\u7684\u3002\\n\\n- \u4f18\u70b9\\n  - \u4e00\u65e6\u4e1a\u52a1\u4e2d\u6240\u6709\u4f9d\u8d56\u7684\u8be5\u7ec4\u4ef6\u7248\u672c\u53f7\u90fd\u662f\u91cd\u6784\u540e\u7684\u7248\u672c\uff0c\u662f\u540e\u7eed\u6240\u6709\u6837\u5f0f\u4e0d\u4f1a\u5e72\u6270\u3002\\n- \u7f3a\u70b9\\n  - \u662f\u5bf9\u539f\u6709\u6837\u5f0f\u9700\u8981\u6539\u9020\uff0c\u539f\u6709\u6743\u91cd\u53ef\u80fd\u4f1a\u63d0\u5347\uff0c\u5f71\u54cd\u73b0\u5b58\u4e1a\u52a1\u4ed3\u5e93\u4e2d\u7684\u6837\u5f0f\u3002\\n  - \u7531\u4e8e\u539f\u6765\u7684\u6837\u5f0f\u7f16\u5199\u6bd4\u8f83\u6df7\u4e71\uff0c\u53ef\u80fd\u9700\u8981\u4e00\u5b9a\u7684\u6539\u9020\u6210\u672c\uff0c\u4f46\u662f\u6bcf\u4e2a\u7ec4\u4ef6\u4ec5\u9700\u4e00\u6b21\u6539\u9020\u3002\\n  - \u5982\u679c\u4e1a\u52a1\u4e2d\u5b58\u5728\u6539\u9020\u540e\u7684\u7248\u672cA\u548c\uff0c\u6539\u9020\u524d\u7684\u7248\u672cB\uff0c\u90a3\u4e48B\u4e2d\u7684\u6837\u5f0f\u4f9d\u7136\u4f1a\u9002\u7528\u4e8eA\u3002\\n\\n#### \u65b9\u68481.2\\n\\n\u539f\u6709\u6837\u5f0f\u4f9d\u65e7\u4fdd\u5b58\uff0c\u540e\u7eed\u65b0\u589e\u6837\u5f0f\u91c7\u7528hash\u7684\u65b9\u5f0f\u3002\\n\\n- \u4f18\u70b9\\n  - \u517c\u5bb9\u8001\u7248\u672c\uff0c\u539f\u6709\u6837\u5f0f\u4f9d\u65e7\u5b58\u5728\uff0c\u540e\u7eed\u65b0\u589e\u7684\u6837\u5f0f\u4fdd\u8bc1\u4e86\u9694\u79bb\u3002\\n- \u7f3a\u70b9\\n  - \u8001\u6837\u5f0f\u4f9d\u65e7\u4f1a\u5b58\u5728\u6837\u5f0f\u8986\u76d6\u3002\\n\\n#### \u65b9\u68481.3  \u2705\\n\\n\u57fa\u4e8e\u65b9\u68481.1\uff0c\u5229\u7528:where\u96f6\u6743\u91cd\u7684\u7279\u70b9\u8fdb\u884c\u57fa\u4e8ehash\u751f\u6210\u6837\u5f0f\u3002\\n``` less\\n@m4b-button-version: getHashedVersion();\\n.m4b-button:where([data-v=~\'@{hashed-version}\']) {\\n    ...\\n}\\n```\\n\\n- \u4f18\u70b9\\n  - \u4e0d\u4f1a\u5bf9\u539f\u6709\u6743\u91cd\u9020\u6210\u4efb\u4f55\u5f71\u54cd\uff0c\u539f\u6709\u7684\u6837\u5f0f\u8986\u76d6\u4f9d\u65e7\u751f\u6548\u3002\\n- \u7f3a\u70b9\\n  - :where\u9700\u8981chrome88\u7248\u672c\u53ca\u4ee5\u4e0a\u624d\u53ef\u4ee5\u751f\u6548\u3002\\n\\n### \u65b9\u68482 \u2014\u2014 \u57fa\u4e8ehash\u4e2d\u7f00\\n\\n\u4f9d\u8d56package.json\u4e2d\u7684\u552f\u4e00\u6027\uff0c\u901a\u8fc7\u5728\u6837\u5f0f\u4e2d\u589e\u52a0\u4e00\u4e2ahashed-version\\n\\n#### \u8001\u4ee3\u7801\\n```css\\n.m4b-button {\\n    ...\\n}\\n```\\n\\n#### \u65b0\u4ee3\u7801\\n```less\\n@import \'~@m4b-design/utils/es/styles/index.less\';\\n@import \'./token.less\';\\n\\n// \u6ce8\u5165\u6837\u5f0f\u53d8\u91cf\u548c\u4f9d\u8d56\u7684\u7ec4\u4ef6\u6837\u5f0f\u53d8\u91cf\\n.load-m4b-alert-token();\\n\\n.load-m4b-alert-style(@m4b-alert-prefix-cls) {\\n    // \u4e0e\u539f\u6709\u6837\u5f0f\u4fdd\u6301\u4e00\u81f4\\n    .@{m4b-alert-prefix-cls} {\\n    \\n    }\\n}\\n\\n// \u751f\u6210\u666e\u901a\u7248\u672c\u6837\u5f0f .m4b-alert\\n.load-m4b-alert-style(@m4b-alert-prefix-cls);\\n// \u751f\u6210\u5e26hash\u7248\u672c\u6837\u5f0f .m4b-xxx-alert\\n.load-m4b-alert-style(@m4b-alert-prefix-cls-with-hashed-version);\\n```\\n\\n##### \u9700\u8981\u5bf9ts\u6ce8\u5165token.ts\\n```ts\\n// \u7531\u811a\u672c\u8bfb\u53d6package.json\u751f\u6210\\nexport const M4B_ALERT_VERSION = \'1.3.21-alpha.1\';\\n// \u7531\u811a\u672c\u8bfb\u53d6package.json\u540e\u5229\u7528\u7edf\u4e00\u7684hash\u7b97\u6cd5\u751f\u6210\\nexport const M4B_ALERT_HASHED_VERSION = \'7azdi9\';\\n// \u5bfc\u51fa\u5f53\u524d\u7ec4\u4ef6\u6240\u4f9d\u8d56\u7684\u7ec4\u4ef6\u7684token\uff0c\u65b9\u4fbf\u6837\u5f0f\u8986\u76d6\\nexport * from \'@m4b-design/button/es/token\';\\n```\\n\\n##### \u9700\u8981\u5bf9less\u6ce8\u5165token.less\\n```less\\n@import (multiple) \'~@m4b-design/utils/es/styles/index.less\';\\n@import \'~@m4b-design/button/es/style/token.less\';\\n\\n// \u751f\u6210mixin\u65b9\u4fbf\u6837\u5f0f\u53d8\u91cf\u6ce8\u5165\\n.load-m4b-alert-token() {\\n  .load-m4b-button-token();\\n  @m4b-alert-version: ~\'1.3.21-alpha.1\';\\n  @m4b-alert-hashed-version: ~\'7azdi9\';\\n  @m4b-alert-prefix-cls: ~\'@{m4b-prefix-cls}-alert\';\\n  @m4b-alert-prefix-cls-with-hashed-version: ~\'@{m4b-prefix-cls}-@{m4b-alert-hashed-version}-alert\';\\n}\\n\\n```\\n\\n##### \u9700\u8981\u5bf9\u4ee3\u7801\u8fdb\u884c\u4fee\u6539(alert.tsx)\\n```ts\\nexport function usePrefix(suffix: string, styleIsolationTag: string) {\\n  // \u5728ConfigProvider\u4e2d\u589e\u52a0styleIsolation\u53d8\u91cf\u65b9\u4fbf\u8bfb\u53d6\u5f53\u524d\u662f\u5426\u9700\u8981\u6837\u5f0f\u9694\u79bb\\n  const { prefixCls: globalPrefixCls, styleIsolation } = useConfigContext();\\n  // \u6839\u636e\u662f\u5426\u9694\u79bb\u751f\u6210.m4b-alert\u8fd8\u662f.m4b-xxx-alert\\n  const prefixCls = [globalPrefixCls, styleIsolation && styleIsolationTag, suffix]\\n    .filter(Boolean)\\n    .join(\'-\');\\n  return prefixCls;\\n}\\nconst prefixCls = usePrefix(\'alert\', M4B_ALERT_HASHED_VERSION);\\n```\\n\\n##### \u65b0\u589e\u6279\u91cf\u811a\u672c\u5de5\u5177\u6ce8\u5165token\\n```ts\\n/* eslint-disable @typescript-eslint/no-unused-vars */\\n/* eslint-disable no-console */\\n/* eslint-disable no-unused-expressions */\\nimport \'zx/globals\';\\nimport hash from \'@emotion/hash\';\\nimport changeCase from \'change-case\';\\n\\nconst rootPath = path.resolve(__dirname, \'..\');\\nconst packagePath = path.resolve(rootPath, \'packages\');\\nconst ignoreDir = [\\n  \'config-provider\',\\n  \'component-template\',\\n  \'components\',\\n  \'iconfordemo\',\\n  \'icon\',\\n  \'utils\',\\n  \'locale\',\\n  \'variant-numeric\',\\n  \'shared\',\\n];\\nconst components = (await fs.readdir(packagePath)).filter((dir) => !ignoreDir.includes(dir));\\n\\necho`${components.join(\',\')}`;\\n\\nawait Promise.allSettled(components.map(genToken));\\n\\nasync function init(componentName) {\\n  const componentPath = path.resolve(packagePath, componentName);\\n  const styleFiles = await glob(path.resolve(componentPath, \'src\', \'style\', \'**/*.less\'));\\n  for (const styleFile of styleFiles) {\\n    console.log(styleFile);\\n  }\\n  // await fs.appendFile(path.resolve(componentPath, \'src\', \'index.tsx\'), `\\\\nexport * as TOKEN from \'./token\';`);\\n}\\n\\nfunction pickM4bComponent(pkgJson) {\\n  const res = [];\\n  for (const key of Object.keys(pkgJson.dependencies ?? {})) {\\n    if (key.startsWith(\'@m4b-design/\')) {\\n      const name = key.replace(\'@m4b-design/\', \'\');\\n      if (name !== \'utils\' && name !== \'shared\' && name !== \'config-provider\') {\\n        res.push(name);\\n      }\\n    }\\n  }\\n  return res;\\n}\\n\\nasync function genToken(componentName) {\\n  console.log(\'genToken\', componentName);\\n  const componentPath = path.resolve(packagePath, componentName);\\n  const constantName = changeCase.constantCase(componentName);\\n  const paramName = changeCase.paramCase(componentName);\\n  const pkgJson = await fs.readJSON(path.resolve(componentPath, \'package.json\'));\\n  const version = pkgJson.version;\\n  const hashedVersion = hash(version);\\n  const depComponents = pickM4bComponent(pkgJson);\\n  await fs.writeFile(\\n    path.resolve(componentPath, \'src\', \'token.ts\'),\\n    [\\n      `export const M4B_${constantName}_VERSION = \'${version}\';`,\\n      `export const M4B_${constantName}_HASHED_VERSION = \'${hashedVersion}\';`,\\n      ...depComponents.map((name) => `export * from \'@m4b-design/${name}/es/token\';`),\\n    ].join(\'\\\\n\')\\n  );\\n  // console.log(\'===\', path.resolve(componentPath, \'src\', \'style\', \'token.less\'));\\n  await fs.writeFile(\\n    path.resolve(componentPath, \'src\', \'style\', \'token.less\'),\\n    [\\n      `@import (multiple) \'~@m4b-design/utils/es/styles/index.less\';`,\\n      ...depComponents.map((name) => `@import \'~@m4b-design/${name}/es/style/token.less\';`),\\n      ``,\\n      `.load-m4b-${paramName}-token() {`,\\n      ...depComponents.map((name) => `  .load-m4b-${name}-token();`),\\n      `  @m4b-${paramName}-version: ~\'${version}\';`,\\n      `  @m4b-${paramName}-hashed-version: ~\'${hashedVersion}\';`,\\n      `  @m4b-${paramName}-prefix-cls: ~\'@{m4b-prefix-cls}-${paramName}\';`,\\n      `  @m4b-${paramName}-prefix-cls-with-hashed-version: ~\'@{m4b-prefix-cls}-@{m4b-${paramName}-hashed-version}-${paramName}\';`,\\n      `}`,\\n    ].join(\'\\\\n\')\\n  );\\n}\\n```\\n\\n#### \u4f18\u70b9\\n\\n1. \u5b8c\u5168\u7684\u9694\u79bb\\n1. \u6743\u91cd\u4e0d\u589e\u52a0\\n\\n#### \u7f3a\u70b9\\n1. \u6837\u5f0f\u8986\u76d6\u65e0\u6cd5\u50cf\u5f80\u5e38\u4e00\u6837\u5229\u7528className\u8fdb\u884c\u8986\u76d6\uff0c\u8981\u52a0hash\\n  1. Export Hash (JS / Less)\\n  2. \u624b\u5199\u8986\u76d6 -> \u5347\u7ea7\u540e\\n  3. \u89e3\u51b3\u65b9\u6848\uff1a\\n\\n```less\\n// \u4e00\u4e2a\u7279\u6b8a\u7684scope\uff08\u9875\u9762\uff0c\u7ec4\u4ef6\uff09\u5916\u5c42\\n.lyg {\\nposition: relative;\\n& {\\n    // \u5728\u5355\u72ec\u7684scope\u4e2d\u6ce8\u5165button\u53d8\u91cf\\n    @import (multiple) \'~@m4b-design/button@1.1.24-alpha.7/es/style/token.less\';\\n    .load-m4b-button-token();\\n    .@{m4b-button-prefix-cls-with-hashed-version} {\\n    height: 10px;\\n    }\\n}\\n& {\\n    // \u5728\u5355\u72ec\u7684scope\u4e2d\u6ce8\u5165button\u53d8\u91cf\\n    @import (multiple) \'~@m4b-design/alert@1.3.22-alpha.4/es/style/token.less\';\\n    .load-m4b-alert-token();\\n\\n    .@{m4b-button-prefix-cls-with-hashed-version} {\\n    height: 20px;\\n    }\\n}\\n}\\n```\\n   4. \u7528\u6237\u4e0d\u611f\u77e5\u4f46\u7ec4\u4ef6\u5f00\u53d1\u8005\u9700\u8981\u611f\u77e5\\n   5. \u63d2\u69fd\u7c7b\u578b\u7684\u7ec4\u4ef6\u7684\u6837\u5f0f\u8986\u76d6\u8fd8\u6709\u95ee\u9898\\n```less\\n.m4b-xxx-form {\\n    // input-number\u5e76\u975eform\u7684\u4f9d\u8d56\uff0c\u6240\u4ee5\u65e0\u6cd5\u62ff\u5230\u5f53\u524dinput-number\u7684\u6b63\u786eclassname\\n    .m4b-input-number {\\n    }\\n}\\n```\\n   6. \u89e3\u51b3\u65b9\u6848\\n```less\\n// \u5bf9\u4e8e\u6240\u6709\u7684className\uff0c\u90fd\u6ce8\u5165\u4e00\u4e2a\u7a7a\u7684className\uff0c\u6bd4\u5982.m4b-x-alert\\n// \u8be5className\u4ec5\u7528\u4f5c\u901a\u7528\u7c7b\u540d\u5904\u7406\\nconst prefixClsX = usePrefix(\'x-alert\');\\n.m4b-xxx-form {\\n    .m4b-x-input-number {\\n    }\\n}\\n```\\n   7. \u5bf9\u4e8e\u4e0d\u540c\u7684\u6837\u5f0f\u5de5\u5177\uff0c\u9700\u8981\u6ce8\u5165\u4e0d\u540c\u7684\u6587\u4ef6\\n        1. token.ts\\n        2. token.less\\n        3. token.scss\\n   8. tailwind\u7684\u6837\u5f0f\u56e0\u4e3a\u6743\u91cd\u95ee\u9898\u53ef\u80fd\u65e0\u6cd5\u751f\u6548\\n\\n### \u65b9\u68483\uff08\u4e34\u65f6\uff09 \u2014\u2014 \u624b\u52a8\u66f4\u65b0\u524d\u7f00\u7684\u7279\u4f9b\u7248\\n\\n\u65b0\u8001\u4ee3\u7801\u4e00\u81f4\uff0c\u4fee\u6539packages/utils/src/styles/variable.less\u4e2d\u7684\u53d8\u91cf\uff0c\u5bf9\u6240\u6709\u7684\u5305\u90fd\u589e\u52a0tag\uff0c\u53d1\u5e03\u65f6\u5e26tag\u53d1\u5e03\uff0c\u4e1a\u52a1\u5f3a\u5236\u9501\u6b7b\u7248\u672c\u4e3a\u8be5\u7248\u672c\u3002\\n\\n#### \u6539\u9020\u8fc7\u7a0b\\n\\n##### utils\u4e2d\u7684m4b\u524d\u7f00\\n```less\\n// \u8fd9\u91cc\u4fee\u6539\u6210\u65b0\u7684\u524d\u7f00\\n@m4b-prefix-cls: component-inner-m4b;\\n@arco-prefix-cls: arco;\\n\\n@import \'./token/index.less\';\\n```\\n\\n##### \u53d1\u5e03\u7684\u5305\u7248\u672c\u793a\u4f8b\\n```\\n@m4b-design/utils@1.4.1-dedicated2component\\n@m4b-design/compatibility-tips@2.2.3-dedicated2component\\n@m4b-design/message-editor@1.2.26-dedicated2component\\n@m4b-design/auto-complete@0.0.3-dedicated2component\\n@m4b-design/overflow-text@1.0.3-dedicated2component\\n@m4b-design/descriptions@0.0.1-dedicated2component\\n@m4b-design/tooltip-error@0.2.13-dedicated2component\\n@m4b-design/image-upload@1.7.17-dedicated2component\\n@m4b-design/notification-card@1.0.22-dedicated2component\\n@m4b-design/quick-action@1.2.6-dedicated2component\\n@m4b-design/date-picker@2.0.42-dedicated2component\\n@m4b-design/page-header@1.0.14-dedicated2component\\n@m4b-design/input-number@2.0.10-dedicated2component\\n@m4b-design/time-picker@2.1.8-dedicated2component\\n```\\n\\n##### \u53d1\u5e03\u547d\u4ee4\\n`pnpm publish --tag dedicated2component`\\n\\n##### \u6279\u91cf\u53d1\u5e03\u811a\u672c\\n```js\\n/* eslint-disable no-await-in-loop */\\n/* eslint-disable @typescript-eslint/no-unused-vars */\\n/* eslint-disable no-console */\\n/* eslint-disable no-unused-expressions */\\nimport \'zx/globals\';\\n\\nconst used = new Set();\\nconst components = [];\\nconst cmd =\\n  await $`curl -L https://sf-unpkg-src.bytedance.net/@m4b-design/ttp-sync@latest/scripts/auto-sync.sh`;\\n\\nconst syncTTP = async (name, version) => {\\n  const promise = $`bash -s -- --package_name ${name} --versions ${version}`;\\n  promise.stdin.write(cmd.stdout);\\n  promise.stdin.end();\\n  await promise;\\n};\\n\\nconst rootPath = path.resolve(__dirname, \'..\');\\nconst packagePath = path.resolve(rootPath, \'packages\');\\nconst ignoreDir = [\\n  \'component-template\',\\n  \'components\',\\n  \'iconfordemo\',\\n  \'icon\',\\n  \'locale\',\\n  \'variant-numeric\',\\n  \'site\',\\n  \'variantnumericfordemo\',\\n  \'illustrationfordemo\',\\n  \'tokensfordemo\',\\n];\\nignoreDir.push(...ignoreDir.map((item) => `@m4b-design/${item}`));\\nconst depGraphName = \'dep-graph.json\';\\n\\nawait $`pnpm nx dep-graph --file=${depGraphName} --output=json`;\\n\\nconst depGraph = await fs.readJSON(path.resolve(__dirname, \'..\', depGraphName));\\n\\nconst nodes = {};\\nfor (const [name, deps] of Object.entries(depGraph.graph.dependencies)) {\\n  if (!nodes[name]) nodes[name] = {};\\n  const data = nodes[name];\\n  if (!data.dependencies) data.dependencies = [];\\n  for (const { target } of deps) {\\n    data.dependencies.push(target);\\n    if (!nodes[target]) nodes[target] = {};\\n    const depData = nodes[target];\\n    if (!depData.dependents) depData.dependents = [];\\n    depData.dependents.push(name);\\n  }\\n}\\nconst tag = \'dedicated2component\';\\nasync function updateLibVerion(name) {\\n  if (ignoreDir.includes(name)) return;\\n  if (used.has(name)) return;\\n  used.add(name);\\n  const jsonPath = path.resolve(packagePath, name.replace(\'@m4b-design/\', \'\'), \'package.json\');\\n  const json = await fs.readJSON(jsonPath);\\n  if (!json.version.endsWith(`-${tag}`)) json.version += `-${tag}`;\\n  components.push(`${json.name}@${json.version}`);\\n  await fs.writeFile(jsonPath, JSON.stringify(json, null, 4));\\n  await Promise.all((nodes[name].dependents ?? []).map((dep) => updateLibVerion(dep)));\\n}\\n\\nasync function publishLib(name) {\\n  if (used.has(name)) return;\\n  if (ignoreDir.includes(name)) return;\\n  used.add(name);\\n  const jsonPath = path.resolve(packagePath, name.replace(\'@m4b-design/\', \'\'), \'package.json\');\\n  const json = await fs.readJSON(jsonPath);\\n  await within(async () => {\\n    cd(path.dirname(jsonPath));\\n    await $`pnpm publish --tag ${tag}`.nothrow();\\n    await syncTTP(json.name, json.version).nothrow();\\n  });\\n  for (const dep of nodes[name].dependents ?? []) {\\n    await publishLib(dep);\\n  }\\n}\\n\\nconst startComponent = \'@m4b-design/menu\';\\nused.clear();\\nawait updateLibVerion(startComponent);\\nawait $`pnpm -w build`;\\nused.clear();\\nawait publishLib(startComponent);\\necho`pnpm add ${components.join(\' \')}`;\\n```\\n\\n#### \u4f18\u70b9\\n\\n1. \u6539\u9020\u65b9\u4fbf\uff0c\u4ec5\u9700\u6539\u52a8m4b\u53d8\u91cf\u548ctag\uff0c\u6279\u91cf\u53d1\u5e03\u5373\u53ef\\n1. \u80fd\u591f\u81ea\u5b9a\u4e49\u524d\u7f00\uff0c\u8fdb\u884c\u5b8c\u5168\u9694\u79bb\\n1. \u4e0d\u5f71\u54cd\u4ee3\u7801\u539f\u6709\u6743\u91cd\\n\\n#### \u7f3a\u70b9\\n\\n1. \u4f9d\u8d56\u7684\u4ed3\u5e93\u9700\u8981\u5b89\u88c5\u8be5\u4f9d\u8d56\u7248\u672c\u4e14\u9501\u6b7b\\n1. \u5982\u679c\u5728less2css\u65f6\u914d\u7f6e\u4e86\u53d8\u91cf\u7684\u5f3a\u5236\u8986\u76d6\u53ef\u80fd\u5931\u6548\\n1. \u4f9d\u65e7\u5b58\u5728\u65b9\u68482\u7f3a\u70b93\u7684\u95ee\u9898\u3002\\n1. \u9700\u8981\u5728\u4f7f\u7528\u7684\u7ec4\u4ef6\u5916\u90e8\u5305\u88f9ConfigProvider\u8bbe\u7f6e\u7ec4\u4ef6\u4e2d\u7684\u7c7b\u540d\u524d\u7f00\u4e3axxx\u3002\\n1. \u7c7b\u4f3c\u4e8e\u7f3a\u70b94\uff0c\u5982\u679c\u4e00\u4e2a\u7ec4\u4ef6\u5b58\u5728\u900f\u4f20ReactNode\uff0c\u90a3\u4e48\u9700\u8981\u91cd\u7f6e\u7ec4\u4ef6\u7684ConfigProvider\u56dem4b\u3002\\n1. \u7ec4\u4ef6\u4e2d\u4f1a\u4f9d\u8d56\u4e24\u5957\u5305(button, button-tag)\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4ee3\u7801\u91cf\u589e\u52a0\\n1. tailwind\u7684\u6837\u5f0f\u56e0\u4e3a\u6743\u91cd\u95ee\u9898\u53ef\u80fd\u65e0\u6cd5\u751f\u6548\\n\\n### \u65b9\u68484 \u2014\u2014 \u4fdd\u6301\u76f8\u540c\u6743\u91cd\uff0c\u517c\u5bb9tailwind\\n\\n\u867d\u7136\u6837\u5f0f\u9009\u62e9\u53ef\u80fd\u7684\u786e\u9700\u8981\u591a\u4e2a\u7c7b\u540d\u72b6\u6001\u7ec4\u5408\uff0c\u4f46\u662f\u57fa\u4e8e:where\u7684\u96f6\u6743\u91cd\u7279\u6b8a\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6240\u6709\u7684\u6837\u5f0f\u8986\u76d6\u90fd\u53d8\u6210\u4e00\u4e2a\u5355\u4f4d\u7684\u6743\u91cd\u4e0etailwind\u4fdd\u6301\u4e00\u81f4\uff0c\u8fd9\u6837\u5c31\u80fd\u591f\u4fdd\u8bc1taildwind\u65b9\u5f0f\u7684\u4f20\u53c2\u80fd\u591f\u8986\u76d6\u539f\u6709\u6837\u5f0f\u3002\\n\\n#### \u4ee3\u7801\\n```less\\n.m4b-button :where(.m4b-icon) :where(svg) {\\n}\\n.m4b-button:where(:hover) {\\n}\\n```\\n\\n#### \u4f18\u70b9\\n\\n1. \u6240\u6709\u4ee3\u7801\u6743\u91cd\u4fdd\u6301\u4e00\u81f4\uff0c\u76f8\u540c\u5c5e\u6027\u662f\u5426\u751f\u6548\u53ea\u770b\u5148\u540e\u987a\u5e8f\u3002\\n1. \u591a\u4e2a\u9009\u62e9\u5668\u7ec4\u5408\u540e\uff0ctaildwind\u7684\u539f\u5b50\u65b9\u5f0f\u4e5f\u80fd\u751f\u6548\u3002\\n\\n#### \u7f3a\u70b9\\n\\n1. \u5f00\u53d1\u6837\u5f0f\u4e2d\u5927\u91cf\u5b58\u5728:where\uff0c\u4f1a\u589e\u52a0\u5f00\u53d1\u4eba\u5458\u8d1f\u62c5\\n1. \u548c\u65b9\u68481.3\u4e00\u6837\uff0c\u9700\u8981\u8003\u8651:where\u517c\u5bb9\u6027"},{"id":"/web/ts-bug-peer-dep","metadata":{"permalink":"/blog/web/ts-bug-peer-dep","source":"@site/blog/web/ts-bug-peer-dep.mdx","title":"\u5b58\u5728 Peer \u4f9d\u8d56\u65f6\uff0cTypeScript \u548c Pnpm \u4e00\u8d77\u7528\u53ef\u80fd\u51fa\u73b0 bug","description":"\u80cc\u666f","date":"2024-07-09T11:13:42.000Z","tags":[],"readingTime":4.61,"hasTruncateMarker":false,"authors":[],"frontMatter":{},"unlisted":false,"prevItem":{"title":"\u7ec4\u4ef6\u5e93\u6837\u5f0f\u9694\u79bb\u65b9\u6848","permalink":"/blog/web/component-library-style-isolation"},"nextItem":{"title":"\u5224\u65ad\u9f20\u6807\u662f\u5426\u9009\u4e2d\u7269\u4f53","permalink":"/blog/webgl/\u5224\u65ad\u9f20\u6807\u662f\u5426\u9009\u4e2d\u7269\u4f53"}},"content":"## \u80cc\u666f\\n\\n\u6700\u8fd1\u5728\u8425\u9500\u57df\u5728\u4f7f\u7528@m4b-deisgn/components \u65f6\uff0c\u51fa\u73b0\u4e00\u4e2a\u975e\u5e38\u5947\u602a\u7684 bug\u2014\u2014TS \u4f1a\u62a5\u7c7b\u578b\u9519\u8bef\u3002\\n\\n\u4e3a\u4e86\u66f4\u6e05\u6670\u7684\u89e3\u91ca\u8fd9\u4e2a bug \u539f\u7406\uff0c\u6211\u62bd\u79bb\u51fa\u4e00\u4e2a\u6700\u5c0f\u5316\u7684 Demo\uff0cpnpm install \u540e\uff0c\u5728 app \u5e94\u7528\u4e0b\u8dd1 pnpm start\uff0c\u6216\u8005\u5229\u7528 IDE \u6253\u5f00 app.tsx \u90fd\u53ef\u590d\u73b0\u95ee\u9898\u3002\\n\\n![\u56fe\u7247](./static/ts-bug-peer-dep-1.png)\\n![\u56fe\u7247](./static/ts-bug-peer-dep-2.png)\\n\\n\u62a5\u9519\u5728\u4e8e\u5b58\u5728\u4e24\u4e2a button \u7248\u672c 0.0.1 \u548c 0.0.2\uff0c\u5f53\u6211\u76f4\u63a5\u4ece button \u5305\u4e2d\u53bb\u5f15\u5165 createButton \u65f6\uff0c\u8fd9\u4e2a button \u5305\u662f 0.0.2 \u7248\u672c\u7684\uff0c\u8fd9\u662f\u5408\u7406\u7684\uff0c\u56e0\u4e3a\u5728 app \u5e94\u7528\u4e2d\uff0cdependencies \u58f0\u660e\u4e86 button \u662f 0.0.2 \u7248\u672c\u3002\\n\\n\u4f46\u662f\u5728 components \u5305\u4e2d\u4f9d\u8d56\u7684 button \u662f peer \u7684\uff0c\u800c\u4e14\u662f\\\\*\u7684\u4f9d\u8d56\uff0c\u8868\u793a\u517c\u5bb9\u6240\u6709\u7248\u672c\u3002\\n\\n![\u56fe\u7247](./static/ts-bug-peer-dep-3.png)\\n\\n\u6309\u7167\u6b63\u5e38 import \u7684\u903b\u8f91\uff0c\u624b\u52a8\u9012\u5f52\u7684\u5411\u4e0a\u5bfb\u627e\u5b83\u7684\u4f9d\u8d56\uff0c\u4e5f\u4f1a\u53d1\u73b0 components \u6b63\u5e38\u6765\u8bf4\u5f15\u5165\u7684\u5e94\u8be5\u662f 0.0.2 \u7684 button \u624d\u5bf9\u3002\\n\\n\u800c\u552f\u4e00\u4f7f\u7528\u8fc7 0.0.1 \u7684 button \u662f\u5728 sdk \u4e2d\u5f3a\u4f9d\u8d56\u4e86button@0.0.1\u3002\\n\\n## \u6392\u67e5\\n\\n\u5728\u6700\u521d\u8425\u9500\u4ed3\u5e93\u4e2d\u6392\u67e5\u8fc7\u5f88\u591a\u56e0\u7d20\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\uff1aWebpack \u7684 resolver \u5904\u7406\u6709\u95ee\u9898\u3001pnpm \u4e0d\u540c\u7248\u672c\u5728\u786c\u94fe\u63a5\u7684\u65f6\u5019\u4f1a\u6709\u4e0d\u540c\u7684\u8868\u73b0\u3001pnpm \u5bf9 peer \u5904\u7406\u6709 bug\u3001node \u5bf9\u4e8e\u94fe\u63a5\u5904\u7406\u6709\u95ee\u9898\u3001\u8425\u9500\u57df\u91cc\u9762\u914d\u7f6e\u4e86\u67d0\u4e9b\u9ed1\u9b54\u6cd5\u3001Ts \u89e3\u6790\u6709 bug\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\\n\\n## \u539f\u56e0\\n\\n\u6392\u67e5\u8fc7\u5f88\u591a\u53ef\u80fd\u6027\u7684\u56e0\u7d20\u540e\uff0c\u6700\u7ec8\u628a\u95ee\u9898\u5b9a\u4f4d\u5728 ts \u672c\u8eab\u4e0a\u3002\u5229\u7528\u4e0a\u8ff0 Demo \u590d\u73b0\u5b8c\u95ee\u9898\u540e\uff0c\u6211\u62c9\u53d6\u4e86 Typescript \u7684\u6e90\u7801\u8fdb\u884c debug\u3002\\n\\nTs \u5728\u5bf9\u4e00\u4e2a\u9879\u76ee\u5f00\u59cb\u68c0\u6d4b\u65f6\u4f1a\u8c03\u7528 createProgram\uff0c\u7136\u540e\u5728\u91cc\u9762\u9012\u5f52\u6bcf\u4e00\u4e2a\u6587\u4ef6\u5bf9\u6bcf\u4e00\u4e2a\u6587\u4ef6\u8c03\u7528 findSourceFile \u53bb\u751f\u6210 SourceFile\u3002\u5728 findSourceFile \u4e2d\u4e5f\u4f1a\u901a\u8fc7 processImportedModules \u5bf9\u6587\u4ef6\u7684 import \u8fdb\u884c\u5904\u7406\uff0c\u5728\u91cc\u9762\u5bf9\u6bcf\u4e2a import \u53c8\u4f1a\u91cd\u65b0\u8c03\u7528 findSourceFile\uff0c\u4ece\u800c\u8fbe\u5230\u4e00\u4e2a\u9012\u5f52\u904d\u5386\u6240\u6709\u6587\u4ef6\u7684\u6548\u679c\u3002\\n\\n\u6b64\u65f6\u5c31\u9047\u5230\u8fd9\u4e2a\u95ee\u9898\u7684\u6839\u56e0\u2014\u2014Ts \u5b9e\u9645\u4e0a\u4f1a\u6839\u636e Id \u7f13\u5b58\u8def\u5f84\u3002\\n\\n![\u56fe\u7247](./static/ts-bug-peer-dep-4.png)\\n\\n\u5b83\u4f1a\u5728 3684 \u884c\u901a\u8fc7 id \u7f13\u5b58\u5f53\u524d\u7684 file\uff0c\u5f53\u518d\u6b21\u8c03\u7528 findSourceFile \u7684\u65f6\u5019\uff0c3671 \u7684\u903b\u8f91\u5c31\u4f1a\u662f true\uff0c\u53ef\u4ee5\u901a\u8fc7 3672-3673 \u8fd9\u4e24\u884c\u6ce8\u91ca\u4e86\u89e3\u5230\uff0c\u5f53 id \u76f8\u540c\u7684\u65f6\u5019\u4ed6\u5c31\u4f1a\u590d\u5236\u539f\u6709\u7684 sourceFile \u800c\u4e0d\u662f\u65b0\u5efa\u3002\u800c Id \u7684\u6784\u5efa\u4ec5\u901a\u8fc7\u5305\u540d\u548c\u7248\u672c\u53f7\u8fdb\u884c\u62fc\u63a5\u3002\\n\\n![\u56fe\u7247](./static/ts-bug-peer-dep-5.png)\\n\\n\u4ee5\u5f53\u524d Demo \u4e3a\u4f8b\uff1a\\n\\nfindSourceFile app.tsx\\n\\n-   findSourceFile @component-type-checker/sdk\\n    -   findSourceFile @component-type-checker+components@0.0.1_@component-type-checker+button@0.0.1\\n        -   findSourceFile @component-type-checker/button@0.0.1\\n-   findSourceFile @component-type-checker+components@0.0.1_@component-type-checker+button@0.0.2\\n    -   reuse sourceFile @component-type-checker+components@0.0.1_@component-type-checker+button@0.0.1\\n\\n\u539f\u56e0\u5c31\u662f\u7b2c\u4e00\u6b21\u51fa\u73b0 button \u5305\u662f\u5728 sdk \u5305\u7684 import \u4e2d\uff0c\u91cc\u9762\u7684\u786e\u662fbutton@0.0.1\uff0c\u5f53\u518d\u6b21\u68c0\u6d4b\u5230 components \u5305\u4e2d\u7684 button \u65f6\u4e0d\u4f1a\u518d\u7528\u6b63\u5e38 import \u7684\u903b\u8f91\u8fdb\u884c\u67e5\u627e\u5305\uff0c\u800c\u662f\u76f4\u63a5\u590d\u7528\u4e0a\u6b21\u627e\u5230\u7684 button \u8fd9\u5c31\u5bfc\u81f4\u4e86\u8fd9\u4e2a\u95ee\u9898\u7684\u51fa\u73b0\u3002\\n\\n\u8fd9\u4e5f\u662f\u4e4b\u524d\u4e3a\u5565\u53c8\u4e0d\u5efa\u8bae\u5927\u5bb6\u4f7f\u7528@m4b-design/components\uff0c\u56e0\u4e3a\u4ed6\u4f1a\u4e71\u5f15\u7528\u7684\u539f\u56e0\u3002\\n\\n\u4e3a\u4e86\u9a8c\u8bc1\uff0c\u5f00\u542f app.tsx \u4e2d\u7684\u7b2c\u4e00\u884c\u6ce8\u91ca\uff0c\u5e76\u6ce8\u91ca\u6389\u7b2c\u4e09\u884c\u3002\\n\\n![\u56fe\u7247](./static/ts-bug-peer-dep-6.png)\\n\\n\u62a5\u9519\u5c31\u6d88\u5931\u4e86\uff0c\u56e0\u4e3a\u6b64\u65f6\u7b2c\u4e00\u6b21\u4f7f\u7528 button \u662f\u5728 components \u4e2d\uff0c\u6240\u4ee5\u88ab\u7f13\u5b58\u7684\u662fbutton@0.0.1\uff0c\u548c\u9879\u76ee\u4e2d\u7684 button \u662f\u540c\u4e00\u4e2a\u7248\u672c\u3002\\n\\n## \u6c9f\u901a\\n\\n\u5f53\u5b9a\u4f4d\u5230\u662f Ts \u539f\u56e0\u540e\uff0c\u6211\u7ed9 Ts \u63d0\u4e86\u4e2a issue\uff0c\u4ed6\u4eec\u4e5f\u7684\u786e\u8ba4\u4e3a\u8fd9\u662f\u4e00\u4e2a bug\uff0c\u5e76\u5728\u6700\u8fd1\u63d0\u4f9b\u4e86\u4fee\u590d\u7684 pr\uff0c\u9884\u671f\u7b49 merged \u540e\u5e94\u8be5\u80fd\u591f\u89e3\u51b3\u3002\u5728\u8425\u9500\u4ed3\u5e93\u4e2d\uff0c\u901a\u8fc7\u8c03\u6362\u521d\u6b21\u5f15\u5165\u7684\u4f4d\u7f6e\u4e5f\u80fd\u591f\u4e34\u65f6\u89e3\u51b3\u8fd9\u4e2a\u62a5\u9519\u3002\\n\\n## \u603b\u7ed3\\n\\n1. Peer \u4f9d\u8d56+Ts+Pnpm \u7684\u786e\u6709 bug\u3002\\n1. ts \u53bb import \u6587\u4ef6\u7684\u65f6\u5019\u4f1a\u7f13\u5b58\uff0c\u800c\u4e0d\u662f\u666e\u901a\u7684\u6309\u7167\u6bcf\u4e2a\u6587\u4ef6\u9012\u5f52\u5411\u4e0a\u627e\u3002\\n1. Ts \u5728\u4fee\u4e86\uff0cPR \u6709\u4e86\uff0c\u4f46\u662f\u622a\u6b62\u6587\u6863\u7f16\u5199\u65f6\u8fd8\u6ca1 merge\u3002\\n1. \u4e34\u65f6\u89e3\u51b3\u53ef\u4ee5\u5728\u9879\u76ee\u5165\u53e3\u5904\u4e3b\u52a8 import \u4e00\u4e2a\u6b63\u786e\u8def\u5f84\uff0c\u4f7f ts \u7f13\u5b58\u3002"},{"id":"/webgl/\u5224\u65ad\u9f20\u6807\u662f\u5426\u9009\u4e2d\u7269\u4f53","metadata":{"permalink":"/blog/webgl/\u5224\u65ad\u9f20\u6807\u662f\u5426\u9009\u4e2d\u7269\u4f53","source":"@site/blog/webgl/\u5224\u65ad\u9f20\u6807\u662f\u5426\u9009\u4e2d\u7269\u4f53.mdx","title":"\u5224\u65ad\u9f20\u6807\u662f\u5426\u9009\u4e2d\u7269\u4f53","description":"\u5224\u65ad\u9f20\u6807\u662f\u5426\u9009\u4e2d\u7269\u4f53\u53ef\u4ee5\u8f6c\u5316\u4e3a\u2014\u2014\u76f8\u673a\u4e0e\u9f20\u6807\u6240\u8fde\u6210\u7684\u5c04\u7ebf\u662f\u5426\u7a7f\u8fc7\u7269\u4f53\u6240\u5728\u7684\u5e73\u9762","date":"2021-11-14T12:51:44.000Z","tags":[],"readingTime":0.71,"hasTruncateMarker":false,"authors":[{"name":"Li Yi Gang","title":"Maintainer of BestLyg","url":"https://github.com/bestlyg","imageURL":"https://github.com/bestlyg.png","key":"lyg"}],"frontMatter":{"authors":["lyg"]},"unlisted":false,"prevItem":{"title":"\u5b58\u5728 Peer \u4f9d\u8d56\u65f6\uff0cTypeScript \u548c Pnpm \u4e00\u8d77\u7528\u53ef\u80fd\u51fa\u73b0 bug","permalink":"/blog/web/ts-bug-peer-dep"},"nextItem":{"title":"\u77e9\u9635","permalink":"/blog/webgl/\u77e9\u9635"}},"content":"\u5224\u65ad\u9f20\u6807\u662f\u5426\u9009\u4e2d\u7269\u4f53\u53ef\u4ee5\u8f6c\u5316\u4e3a\u2014\u2014\u76f8\u673a\u4e0e\u9f20\u6807\u6240\u8fde\u6210\u7684\u5c04\u7ebf\u662f\u5426\u7a7f\u8fc7\u7269\u4f53\u6240\u5728\u7684\u5e73\u9762\\n\\n\u5df2\u77e5\uff1a\\n\\n- \u5c04\u7ebf\\n  - \u539f\u70b9\uff1a${E} = (ex,ey,ez)$\\n  - \u65b9\u5411\uff1a$\\\\overrightarrow{V} = (vx,vy,vz)$\\n- \u5e73\u9762\\n  - \u6cd5\u5411\u91cf\uff1a$\\\\overrightarrow{N} = (nx,ny,nz)$\\n  - \u5e73\u9762\u4e2d\u4efb\u610f\u70b9\uff1a${A} = (ax,ay,az)$\\n\\n1. \u7531\u4e8e$\\\\overrightarrow{N} \\\\bot \\\\overrightarrow{MA}$\u53ef\u5f97$(M - A) \\\\cdot \\\\overrightarrow{N} = 0$\\n1. \u7531\u4e8e$\\\\overrightarrow{EM} = \\\\lambda \\\\cdot \\\\overrightarrow{V}$\u53ef\u5f97$M - E = \\\\lambda \\\\times \\\\overrightarrow{V} \\\\Rightarrow M = \\\\lambda \\\\times \\\\overrightarrow{V} + E$\\n1. \u8054\u7acb\u53ef\u5f97\\n   $$\\n   \\\\lambda = \\\\frac{(A - E) \\\\cdot \\\\overrightarrow{N}}{\\\\overrightarrow{V} \\\\cdot \\\\overrightarrow{N}}\\n   $$\\n   $$\\n   M = \\\\frac{(A - E) \\\\cdot \\\\overrightarrow{N}}{\\\\overrightarrow{V} \\\\cdot \\\\overrightarrow{N}} \\\\times \\\\overrightarrow{V} + E\\n   $$"},{"id":"/webgl/\u77e9\u9635","metadata":{"permalink":"/blog/webgl/\u77e9\u9635","source":"@site/blog/webgl/\u77e9\u9635.mdx","title":"\u77e9\u9635","description":"\u5feb\u901f\u8ba1\u7b97\u5411\u91cf\u4f4d\u7f6e\uff0c\u4e0b\u6587\u77e9\u9635\u5168\u662f\u5217\u4e3b\u5e8f\u56db\u9636\u77e9\u9635","date":"2021-10-12T09:54:42.000Z","tags":[],"readingTime":9.195,"hasTruncateMarker":false,"authors":[{"name":"Li Yi Gang","title":"Maintainer of BestLyg","url":"https://github.com/bestlyg","imageURL":"https://github.com/bestlyg.png","key":"lyg"}],"frontMatter":{"authors":["lyg"]},"unlisted":false,"prevItem":{"title":"\u5224\u65ad\u9f20\u6807\u662f\u5426\u9009\u4e2d\u7269\u4f53","permalink":"/blog/webgl/\u5224\u65ad\u9f20\u6807\u662f\u5426\u9009\u4e2d\u7269\u4f53"},"nextItem":{"title":"\u65cb\u8f6c","permalink":"/blog/webgl/\u65cb\u8f6c"}},"content":"\u5feb\u901f\u8ba1\u7b97\u5411\u91cf\u4f4d\u7f6e\uff0c\u4e0b\u6587\u77e9\u9635\u5168\u662f\u5217\u4e3b\u5e8f\u56db\u9636\u77e9\u9635\\n\\n-   \u5b9a\u4e49\u5411\u91cf$\\\\overrightarrow{vec} = (x,y,z,w)$\\n-   \u5b9a\u4e49\u77e9\u9635\\n    $\\n  mat4 =\\n  \\\\begin{bmatrix}\\n  m_{11} & m_{12} & m_{13} & m_{14} \\\\\\\\\\n  m_{21} & m_{22} & m_{23} & m_{24} \\\\\\\\\\n  m_{31} & m_{32} & m_{33} & m_{34} \\\\\\\\\\n  m_{41} & m_{42} & m_{43} & m_{44} \\\\\\\\\\n  \\\\end{bmatrix}\\n  $\\n\\n## \u56db\u9636\u77e9\u9635\\n\\n### \u5411\u91cf\u4e0e\u77e9\u9635\u76f8\u4e58\\n\\n$$\\n\\\\begin{pmatrix}\\nx = x * m_{11} + y * m_{21} + z * m_{31} + w * m_{41} ,\\\\\\\\\\ny = x * m_{12} + y * m_{22} + z * m_{32} + w * m_{42} ,\\\\\\\\\\nz = x * m_{13} + y * m_{23} + z * m_{33} + w * m_{43} ,\\\\\\\\\\nw = x * m_{14} + y * m_{24} + z * m_{34} + w * m_{44} ,\\\\\\\\\\n\\\\end{pmatrix}\\n=\\nmat4\\n\\\\times\\n\\\\overrightarrow{vec}\\n$$\\n\\n$$\\n\\\\begin{pmatrix}\\nx = x * m_{11} + y * m_{12} + z * m_{13} + w * m_{14} ,\\\\\\\\\\ny = x * m_{22} + y * m_{22} + z * m_{23} + w * m_{24} ,\\\\\\\\\\nz = x * m_{33} + y * m_{32} + z * m_{33} + w * m_{34} ,\\\\\\\\\\nw = x * m_{44} + y * m_{42} + z * m_{43} + w * m_{44} ,\\\\\\\\\\n\\\\end{pmatrix}\\n=\\n\\\\overrightarrow{vec}\\n\\\\times\\nmat4\\n$$\\n\\n### \u77e9\u9635\u4e0e\u77e9\u9635\u76f8\u4e58\\n\\n$$\\n\\\\begin{bmatrix}\\nm_{a11} & m_{a12} & m_{a13} & m_{a14} \\\\\\\\\\nm_{a21} & m_{a22} & m_{a23} & m_{a24} \\\\\\\\\\nm_{a31} & m_{a32} & m_{a33} & m_{a34} \\\\\\\\\\nm_{a41} & m_{a42} & m_{a43} & m_{a44} \\\\\\\\\\n\\\\end{bmatrix}\\n\\\\times\\n\\\\begin{bmatrix}\\nm_{b11} & m_{b12} & m_{b13} & m_{b14} \\\\\\\\\\nm_{b21} & m_{b22} & m_{b23} & m_{b24} \\\\\\\\\\nm_{b31} & m_{b32} & m_{b33} & m_{b34} \\\\\\\\\\nm_{b41} & m_{b42} & m_{b43} & m_{b44} \\\\\\\\\\n\\\\end{bmatrix}\\n$$\\n\\n-   $$\\n    m_{c11} = m_{a11} \\\\times m_{b11} + m_{a21} \\\\times m_{b12} + m_{a31} \\\\times m_{b13} + m_{a41} \\\\times m_{b14}\\n    $$\\n-   $$\\n    m_{c12} = m_{a11} \\\\times m_{b21} + m_{a21} \\\\times m_{b22} + m_{a31} \\\\times m_{b23} + m_{a41} \\\\times m_{b24}\\n    $$\\n-   $$\\n    m_{c13} = m_{a11} \\\\times m_{b31} + m_{a21} \\\\times m_{b32} + m_{a31} \\\\times m_{b33} + m_{a41} \\\\times m_{b34}\\n    $$\\n-   $$\\n    m_{c14} = m_{a12} \\\\times m_{b41} + m_{a22} \\\\times m_{b42} + m_{a32} \\\\times m_{b43} + m_{a42} \\\\times m_{b44}\\n    $$\\n-   $$\\n    m_{c21} = m_{a12} \\\\times m_{b11} + m_{a22} \\\\times m_{b12} + m_{a32} \\\\times m_{b13} + m_{a42} \\\\times m_{b14}\\n    $$\\n-   $$\\n    m_{c22} = m_{a12} \\\\times m_{b21} + m_{a22} \\\\times m_{b22} + m_{a32} \\\\times m_{b23} + m_{a42} \\\\times m_{b24}\\n    $$\\n-   $$\\n    m_{c23} = m_{a12} \\\\times m_{b31} + m_{a22} \\\\times m_{b32} + m_{a32} \\\\times m_{b33} + m_{a42} \\\\times m_{b34}\\n    $$\\n-   $$\\n    m_{c24} = m_{a12} \\\\times m_{b41} + m_{a22} \\\\times m_{b42} + m_{a32} \\\\times m_{b43} + m_{a42} \\\\times m_{b44}\\n    $$\\n-   $$\\n    m_{c31} = m_{a13} \\\\times m_{b11} + m_{a23} \\\\times m_{b12} + m_{a33} \\\\times m_{b13} + m_{a43} \\\\times m_{b14}\\n    $$\\n-   $$\\n    m_{c32} = m_{a13} \\\\times m_{b21} + m_{a23} \\\\times m_{b22} + m_{a33} \\\\times m_{b23} + m_{a43} \\\\times m_{b24}\\n    $$\\n-   $$\\n    m_{c33} = m_{a13} \\\\times m_{b31} + m_{a23} \\\\times m_{b32} + m_{a33} \\\\times m_{b33} + m_{a43} \\\\times m_{b34}\\n    $$\\n-   $$\\n    m_{c34} = m_{a13} \\\\times m_{b41} + m_{a23} \\\\times m_{b42} + m_{a33} \\\\times m_{b43} + m_{a43} \\\\times m_{b44}\\n    $$\\n-   $$\\n    m_{c41} = m_{a14} \\\\times m_{b11} + m_{a24} \\\\times m_{b12} + m_{a34} \\\\times m_{b13} + m_{a44} \\\\times m_{b14}\\n    $$\\n-   $$\\n    m_{c42} = m_{a14} \\\\times m_{b21} + m_{a24} \\\\times m_{b22} + m_{a34} \\\\times m_{b23} + m_{a44} \\\\times m_{b24}\\n    $$\\n-   $$\\n    m_{c43} = m_{a14} \\\\times m_{b31} + m_{a24} \\\\times m_{b32} + m_{a34} \\\\times m_{b33} + m_{a44} \\\\times m_{b34}\\n    $$\\n-   $$\\n    m_{c44} = m_{a14} \\\\times m_{b41} + m_{a24} \\\\times m_{b42} + m_{a34} \\\\times m_{b43} + m_{a44} \\\\times m_{b44}\\n    $$\\n\\n## \u6a21\u578b\u77e9\u9635\\n\\n### \u4f4d\u79fb\\n\\n$$\\n\\\\begin{pmatrix}\\nx + x_1 , \\\\\\\\\\ny + y_1 , \\\\\\\\\\nz + z_1 , \\\\\\\\\\nw , \\\\\\\\\\n\\\\end{pmatrix}  =\\n\\\\begin{bmatrix}\\n1 & 0 & 0 & 0 \\\\\\\\\\n0 & 1 & 0 & 0 \\\\\\\\\\n0 & 0 & 1 & 0 \\\\\\\\\\nx_1 & y_1 & z_1 & 1 \\\\\\\\\\n\\\\end{bmatrix}\\n\\\\times\\n\\\\overrightarrow{vec}\\n$$\\n\\n### \u7f29\u653e\\n\\n$$\\n\\\\begin{pmatrix}\\nx \\\\times x_1 , \\\\\\\\\\ny \\\\times y_1 , \\\\\\\\\\nz \\\\times z_1 , \\\\\\\\\\nw , \\\\\\\\\\n\\\\end{pmatrix}  =\\n\\\\begin{bmatrix}\\nx_1 & 0 & 0 & 0 \\\\\\\\\\n0 & y_1 & 0 & 0 \\\\\\\\\\n0 & 0 & z_1 & 0 \\\\\\\\\\n0 & 0 & 0 & 1 \\\\\\\\\\n\\\\end{bmatrix}\\n\\\\times\\n\\\\overrightarrow{vec}\\n$$\\n\\n### \u65cb\u8f6c\\n\\n[\u65cb\u8f6c](./\u65cb\u8f6c.mdx)\\n\\n## \u89c6\u56fe\u77e9\u9635\\n\\n\u901a\u8fc7\u76ee\u6807\u70b9\uff0c\u89c6\u70b9\uff0c\u4e0a\u65b9\u5411\uff0c\u4e09\u4e2a\u70b9\u8ba1\u7b97\u89c6\u56fe\u77e9\u9635\u3002x,y \u65b9\u5411\u4e0d\u53d8\uff0cz \u65b9\u5411\u76f8\u53cd\u3002\\n\\n-   \u76ee\u6807\u70b9:$\\\\overrightarrow{target} = (tx,ty,tz,tw)$\\n-   \u89c6\u70b9:$\\\\overrightarrow{eye} = (ex,ey,ez,ew)$\\n-   \u4e0a\u65b9\u5411:$\\\\overrightarrow{up} = (ux,uy,uz,uw)$\\n\\n1. \u4ee5\u76ee\u6807\u70b9\u4e3a\u8d77\u70b9\uff0c\u89c6\u70b9\u4e3a\u7ec8\u70b9\u8ba1\u7b97$\\\\overrightarrow{d} = \\\\overrightarrow{eye} - \\\\overrightarrow{target} = (dx,dy,dz,dw)$\\n1. \u5c06$\\\\overrightarrow{d}$\u5f52\u4e00\u5316$\\\\overrightarrow{d} *= 1 / |\\\\overrightarrow{d}|$\\n1. \u5229\u7528$\\\\overrightarrow{d}$\u4e0e\u4e0a\u65b9\u5411\u53c9\u4e58\u6c42\u51fa$\\\\overrightarrow{a} = \\\\overrightarrow{d} \\\\times \\\\overrightarrow{up} = (ax,ay,az,aw) $\\n1. \u5c06$\\\\overrightarrow{a}$\u5f52\u4e00\u5316$\\\\overrightarrow{a} *= 1 / |\\\\overrightarrow{a}|$\\n1. \u5229\u7528$\\\\overrightarrow{d}$\u4e0e\u4e0a\u65b9\u5411\u53c9\u4e58\u6c42\u51fa$\\\\overrightarrow{b} = \\\\overrightarrow{d} \\\\times \\\\overrightarrow{a} = (bx,by,bz,bw) $\\n1. \u5229\u7528$\\\\overrightarrow{d}$\u53d6\u53cd\u6c42\u51fa$\\\\overrightarrow{c} = -\\\\overrightarrow{d} $\\n1. $(\\\\overrightarrow{a},\\\\overrightarrow{b},\\\\overrightarrow{c})$\u5373\u4e3a\u89c6\u56fe\u77e9\u9635\u4e2d\u7684$(\\\\overrightarrow{x},\\\\overrightarrow{y},\\\\overrightarrow{z})$\\n\\n## \u6b63\u4ea4\u6295\u5f71\u77e9\u9635\\n\\n\u5728\u88c1\u526a\u7a7a\u95f4\u5185\uff0c\u7269\u4f53\u5927\u5c0f\u4e0d\u4f1a\u56e0\u4e3a\u8ddd\u79bb\u8fdc\u8fd1\u800c\u6539\u53d8\uff0c\u901a\u8fc7\u4e0a\u4e0b\u8fb9\u754c\uff0c\u5de6\u53f3\u8fb9\u754c\uff0c\u8fd1\u5e73\u9762\uff0c\u8fdc\u5e73\u9762\u8ba1\u7b97\u6b63\u4ea4\u6295\u5f71\u77e9\u9635\u3002\\n\\n-   \u4e0a\u8fb9\u754c:top\\n-   \u4e0b\u8fb9\u754c:bottom\\n-   \u5de6\u8fb9\u754c:left\\n-   \u53f3\u8fb9\u754c:right\\n-   \u8fd1\u5e73\u9762:near\\n-   \u8fdc\u5e73\u9762:far\\n\\n1. \u8ba1\u7b97\u88c1\u526a\u7a7a\u95f4\u7684\u4e09\u8f74\u65b9\u5411\u957f\u5ea6\u4e0e\u76f8\u673a\u4e16\u754c\u7684\u4e09\u8f74\u65b9\u5411\u4e0a\u7684 1 \u4e2a\u5355\u4f4d\u6bd4\u4f8b\u5173\u7cfb\u3002\\n    - \u88c1\u526a\u7a7a\u95f4(\u7528 1 \u8868\u793a) / \u76f8\u673a\u4e16\u754c(\u7528 2 \u8868\u793a\uff0c\u9ed8\u8ba4\u4e3a 1)\\n    - $ w_1 = \\\\frac{w_1}{w_2} = \\\\frac{2}{right - left}$\\n    - $ h_1 = \\\\frac{h_1}{h_2} = \\\\frac{2}{top - bottom}$\\n    - $ p_1 = \\\\frac{p_1}{p_2} = \\\\frac{2}{far - near}$\\n1. \u901a\u8fc7\u6bd4\u4f8b\u5173\u7cfb\u6c42\u51fa\u77e9\u9635\u4e0e\u88c1\u526a\u7a7a\u95f4\u7684\u4f4d\u79fb\u91cf\\n    - $ x = \\\\frac{right + left}{2} \\\\times \\\\frac{2}{right - left} = \\\\frac{right + left}{right - left} $\\n    - $ y = \\\\frac{top + bottom}{2} \\\\times \\\\frac{2}{top - bottom} = \\\\frac{top + bottom}{top - bottom} $\\n    - $ z = \\\\frac{far + near}{2} \\\\times \\\\frac{2}{far - near} = \\\\frac{far + near}{far - near} $\\n\\n-   $$\\n      orthographicProjection =\\n      \\\\begin{bmatrix}\\n      \\\\frac{2}{right - left}            & 0                                 & 0                             & 0 \\\\\\\\\\n      0                                 & \\\\frac{2}{top - bottom}            & 0                             & 0 \\\\\\\\\\n      0                                 & 0                                 & \\\\frac{2}{far - near}          & 0 \\\\\\\\\\n      \\\\frac{right + left}{right - left} & \\\\frac{top + bottom}{top - bottom} & \\\\frac{far + near}{far - near} & 1 \\\\\\\\\\n      \\\\end{bmatrix}\\n      =\\n    $$\\n\\n## \u900f\u89c6\u6295\u5f71\u77e9\u9635\\n\\n\u5728\u88c1\u526a\u7a7a\u95f4\u5185\uff0c\u7269\u4f53\u5927\u5c0f\u4f1a\u56e0\u4e3a\u8ddd\u79bb\u8fdc\u8fd1\u800c\u6539\u53d8\uff0c\u901a\u8fc7\u4e0a\u4e0b\u8fb9\u754c\uff0c\u5de6\u53f3\u8fb9\u754c\uff0c\u8fd1\u5e73\u9762\uff0c\u8fdc\u5e73\u9762\u8ba1\u7b97\u6b63\u4ea4\u6295\u5f71\u77e9\u9635\u3002\\n\\n-   fov:\u6444\u50cf\u673a\u89c6\u9525\u4f53\u5782\u76f4\u89c6\u91ce\u89d2\u5ea6\\n-   aspect:\u6444\u50cf\u673a\u89c6\u9525\u4f53\u5bbd\u9ad8\u6bd4\\n-   near:\u6444\u50cf\u673a\u8fd1\u88c1\u526a\u9762\u5230\u89c6\u70b9\u7684\u8ddd\u79bb\\n-   far:\u6444\u50cf\u673a\u8fdc\u88c1\u526a\u9762\u5230\u89c6\u70b9\u7684\u8ddd\u79bb\\n\\n1. \u76f8\u673a\u53ef\u89c6\u533a\u57df\u4e3a\u56db\u68f1\u53f0\u5f62\u72b6\uff0c\u8f6c\u5316\u4e3a\u957f\u65b9\u4f53\u5f62\u72b6\u7684\u6295\u5f71\u76d2\u5b50\\n    1. $ \\\\frac{top}{n} = \\\\tan(\\\\frac{fov}{2}) $\\n    1. $ top = \\\\tan(\\\\frac{fov}{2}) \\\\times n $\\n    1. $ bottom = -top $\\n    1. $ \\\\frac{right}{top} = aspect $\\n    1. $ right = top \\\\times aspece $\\n    1. $ left = -right $\\n    1. \u8bbe$ p_1 = ( x_1 , y_1 , z_1 , w_1)$,\u5219$p_1$\u5728\u6295\u5f71\u76d2\u5b50\u91cc\u7684\u6295\u5f71(x \u4e0e y \u53d1\u751f\u504f\u79fb\uff0cz \u4f4d\u7f6e\u4e0d\u53d8)\u4e3a\uff1a\\n    1. $ \\\\frac{x_2}{x_1} = \\\\frac{-n}{z_1} $\\n    1. $ x_2 = \\\\frac{-n}{z_1} \\\\times x_1 $\\n    1. \u540c\u7406\u53ef\u5f97 $ y_2 =\\\\frac{-n}{z_1} \\\\times y_1 $\\n    1. $ p_2 = ( \\\\frac{-n}{z_1} \\\\times x_1 , \\\\frac{-n}{z_1} \\\\times y_1 , z_1 , w_1)$\\n1. \u5c06\u6295\u5f71\u76d2\u5b50\u4e0e\u88c1\u526a\u7a7a\u95f4\u8fdb\u884c\u6620\u5c04\\n    1. \u8bbe\u88c1\u526a\u7a7a\u95f4\u4e2d$ p_3 = ( x_3 , y_3 , z_3 , w_3 ) $\u4e0e\u6295\u5f71\u76d2\u5b50\u4e2d\u7684$ p_2 $\u5bf9\u5e94\\n    1. \u8bbe$ p_4 = p_3 \\\\times -z_1 $\\n    1. $ w_3 = w_1 $\\n    1. $ \\\\frac{ x_3 - (-1) }{ 1 - (-1) } = \\\\frac{ \\\\frac{-n}{z_1} \\\\times x_1 - left }{ right - left } $\\n    1. $ x_4 = -z_1 \\\\times x_3 = \\\\frac{ 2 \\\\times n}{ right - left } \\\\times x_1 + \\\\frac{ right + left }{ right - left } \\\\times z_1$\\n    1. \u540c\u7406\u53ef\u5f97$ x_4 = -z_1 \\\\times x_3 = \\\\frac{ 2 \\\\times n}{ top - bottom } \\\\times y_1 + \\\\frac{ top + bottom }{ top - bottom } \\\\times z_1$\\n    1. \u4e3a\u4e86\u65b9\u4fbf\u77e9\u9635\u8fd0\u7b97\uff0c\u9006\u5411\u6c42$ z_4 $\u7684\u7ed3\u679c\\n        $$\\n          projectionMatrix =\\n          \\\\begin{bmatrix}\\n          \\\\frac{ 2 \\\\times n}{ right - left }    & 0                                     & 0 & 0  \\\\\\\\\\n          0                                     & \\\\frac{ 2 \\\\times n}{ top - bottom }    & 0 & 0  \\\\\\\\\\n          0                                     & 0                                     & k & -1 \\\\\\\\\\n          \\\\frac{ right + left }{ right - left } & \\\\frac{ top + bottom }{ top - bottom } & b & 1  \\\\\\\\\\n          \\\\end{bmatrix}\\n        $$\\n    1. $ z_4 = -z_1 \\\\times z_3 = k \\\\times z_1 + b $\\n        - \u5f53$z_1 = -n$\u65f6,$z_3 = -1$\\n        - \u5f53$z_1 = -f$\u65f6,$z_3 = 1$\\n        - \u6c42\u51fa$ z_4 = -\\\\frac{far + near}{far-near} \\\\times z_1 - \\\\frac{2 \\\\times near \\\\times far}{far - near}$\\n1. \u6700\u540e\u6c42\u51fa\\n    $$\\n      projectionMatrix =\\n      \\\\begin{bmatrix}\\n      \\\\frac{ 2 \\\\times n}{ right - left }    & 0                                     & 0                                                 & 0  \\\\\\\\\\n      0                                     & \\\\frac{ 2 \\\\times n}{ top - bottom }    & 0                                                 & 0  \\\\\\\\\\n      0                                     & 0                                     & - \\\\frac{ far + near }{ far-near }                 & -1 \\\\\\\\\\n      \\\\frac{ right + left }{ right - left } & \\\\frac{ top + bottom }{ top - bottom } & - \\\\frac{ 2 \\\\times near \\\\times far }{ far - near } & 1  \\\\\\\\\\n      \\\\end{bmatrix}\\n    $$"},{"id":"/webgl/\u65cb\u8f6c","metadata":{"permalink":"/blog/webgl/\u65cb\u8f6c","source":"@site/blog/webgl/\u65cb\u8f6c.mdx","title":"\u65cb\u8f6c","description":"\u7ed5\u8f74\u65cb\u8f6c","date":"2021-10-08T05:42:03.000Z","tags":[],"readingTime":3.05,"hasTruncateMarker":false,"authors":[{"name":"Li Yi Gang","title":"Maintainer of BestLyg","url":"https://github.com/bestlyg","imageURL":"https://github.com/bestlyg.png","key":"lyg"}],"frontMatter":{"authors":["lyg"]},"unlisted":false,"prevItem":{"title":"\u77e9\u9635","permalink":"/blog/webgl/\u77e9\u9635"},"nextItem":{"title":"\u901a\u8fc7\u70b9\u51fb\u4e8b\u4ef6\u83b7\u53d6 WebGL \u5b9a\u4f4d","permalink":"/blog/webgl/\u901a\u8fc7\u70b9\u51fb\u4e8b\u4ef6\u83b7\u53d6WebGL\u5b9a\u4f4d"}},"content":"## \u7ed5\u8f74\u65cb\u8f6c\\n\\n- \u5b9a\u4e49\u5411\u91cf\uff1a$\\\\overrightarrow{vec_1} = (x_1,y_1,z_1,1)$\\n- \u5b9a\u4e49\u65cb\u8f6c\u540e\u7684\u5411\u91cf\uff1a$\\\\overrightarrow{vec_2} = (x_2,y_2,z_2,1)$\\n- \u5b9a\u4e49\u5411\u91cf\u957f\u5ea6\u4e3a\uff1a$len = |\\\\overrightarrow{vec}|$\\n- \u5b9a\u4e49\u5411\u91cf\u4e0e\u8d77\u59cb\u8f74\u7684\u5939\u89d2\u4e3a$\\\\alpha^\\\\circ$\\n- \u5b9a\u4e49\u5411\u91cf\u7ed5\u8f74\u65cb\u8f6c$\\\\beta^\\\\circ$\\n- $ c = \\\\cos(\\\\beta) $\\n- $ s = \\\\sin(\\\\beta) $\\n\\n### \u65cb\u8f6c\u65b9\u5411\\n\\n- \u5f53\u7269\u4f53\u7ed5 z \u8f74\uff0c\u4ece x \u8f74\u6b63\u534a\u8f74\u5411 y \u8f74\u6b63\u534a\u8f74\u9006\u65f6\u9488\u65cb\u8f6c\u65f6\uff0c\u662f\u6b63\u5411\u65cb\u8f6c\uff0c\u53cd\u4e4b\u4e3a\u8d1f\u3002\\n- \u5f53\u7269\u4f53\u7ed5 x \u8f74\uff0c\u4ece y \u8f74\u6b63\u534a\u8f74\u5411 z \u8f74\u6b63\u534a\u8f74\u9006\u65f6\u9488\u65cb\u8f6c\u65f6\uff0c\u662f\u6b63\u5411\u65cb\u8f6c\uff0c\u53cd\u4e4b\u4e3a\u8d1f\u3002\\n- \u5f53\u7269\u4f53\u7ed5 y \u8f74\uff0c\u4ece z \u8f74\u6b63\u534a\u8f74\u5411 x \u8f74\u6b63\u534a\u8f74\u9006\u65f6\u9488\u65cb\u8f6c\u65f6\uff0c\u662f\u6b63\u5411\u65cb\u8f6c\uff0c\u53cd\u4e4b\u4e3a\u8d1f\u3002\\n\\n### \u5b9a\u4e49\u8d77\u59cb\u8f74(\u5f27\u5ea6\u4e3a 0)\\n\\n- \u5f53\u7269\u4f53\u7ed5 z \u8f74\uff0cx \u8f74\u6b63\u534a\u8f74\u4e3a\u8d77\u59cb\u8f74\uff0c\u5f80 y \u8f74\u6b63\u534a\u8f74\u4e3a\u6b63\\n- \u5f53\u7269\u4f53\u7ed5 x \u8f74\uff0cy \u8f74\u6b63\u534a\u8f74\u4e3a\u8d77\u59cb\u8f74\uff0c\u5f80 z \u8f74\u6b63\u534a\u8f74\u4e3a\u6b63\\n- \u5f53\u7269\u4f53\u7ed5 y \u8f74\uff0cz \u8f74\u6b63\u534a\u8f74\u4e3a\u8d77\u59cb\u8f74\uff0c\u5f80 x \u8f74\u6b63\u534a\u8f74\u4e3a\u6b63\\n\\n### \u7ed5 Z \u8f74\u65cb\u8f6c\\n\\n```\\n/*\\n   Y\\n   \u2502\\n   \u2502\\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 X\\n*/\\n```\\n\\n$$\\nx_2\\n   = len \\\\times \\\\cos(\\\\alpha+\\\\beta)\\n   = len \\\\times (\\\\cos(\\\\alpha)\\\\cos(\\\\beta) - \\\\sin(\\\\alpha)\\\\sin(\\\\beta))\\n   = len \\\\times \\\\cos(\\\\alpha) \\\\times \\\\cos(\\\\beta) - len \\\\times \\\\sin(\\\\alpha) \\\\times \\\\sin(\\\\beta)\\n   = x_1 \\\\times \\\\cos(\\\\beta) - y_1 \\\\times \\\\sin(\\\\beta)\\n$$\\n\\n$$\\ny_2\\n   = len \\\\times \\\\sin(\\\\alpha+\\\\beta)\\n   = len \\\\times (\\\\sin(\\\\alpha)\\\\cos(\\\\beta) + \\\\cos(\\\\alpha)\\\\sin(\\\\beta))\\n   = len \\\\times \\\\sin(\\\\alpha) \\\\times \\\\cos(\\\\beta) + len \\\\times \\\\cos(\\\\alpha) \\\\times \\\\sin(\\\\beta)\\n   = y_1 \\\\times \\\\cos(\\\\beta) + x_1 \\\\times \\\\sin(\\\\beta)\\n$$\\n\\n$$\\n\\\\overrightarrow{vec_2} =\\n\\\\begin{bmatrix}\\n{c}  & {s} & 0 & 0 \\\\\\\\\\n{-s} & {c} & 0 & 0 \\\\\\\\\\n0    & 0   & 1 & 0 \\\\\\\\\\n0    & 0   & 0 & 1 \\\\\\\\\\n\\\\end{bmatrix}\\n\\\\times \\\\overrightarrow{vec_1}\\n$$\\n\\n### \u7ed5 X \u8f74\u65cb\u8f6c\\n\\n```\\n/*\\n         Y\\n         \u2502\\n         \u2502\\nZ \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\n*/\\n```\\n\\n$$\\ny_2\\n   = len \\\\times \\\\cos(\\\\alpha+\\\\beta)\\n   = len \\\\times (\\\\cos(\\\\alpha)\\\\cos(\\\\beta) - \\\\sin(\\\\alpha)\\\\sin(\\\\beta))\\n   = len \\\\times \\\\cos(\\\\alpha) \\\\times \\\\cos(\\\\beta) - len \\\\times \\\\sin(\\\\alpha) \\\\times \\\\sin(\\\\beta)\\n   = y_1 \\\\times \\\\cos(\\\\beta) - z_1 \\\\times \\\\sin(\\\\beta)\\n$$\\n\\n$$\\nz_2\\n   = len \\\\times \\\\sin(\\\\alpha+\\\\beta)\\n   = len \\\\times (\\\\sin(\\\\alpha)\\\\cos(\\\\beta) + \\\\cos(\\\\alpha)\\\\sin(\\\\beta))\\n   = len \\\\times \\\\sin(\\\\alpha) \\\\times \\\\cos(\\\\beta) + len \\\\times \\\\cos(\\\\alpha) \\\\times \\\\sin(\\\\beta)\\n   = z_1 \\\\times \\\\cos(\\\\beta) + y_1 \\\\times \\\\sin(\\\\beta)\\n$$\\n\\n$$\\n\\\\overrightarrow{vec_2} =\\n\\\\begin{bmatrix}\\n1 & 0    & 0   & 0 \\\\\\\\\\n0 & {c}  & {s} & 0 \\\\\\\\\\n0 & {-s} & {c} & 0 \\\\\\\\\\n0 & 0    & 0   & 1 \\\\\\\\\\n\\\\end{bmatrix}\\n\\\\times \\\\overrightarrow{vec_1}\\n$$\\n\\n### \u7ed5 Y \u8f74\u65cb\u8f6c\\n\\n```\\n/*\\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 X\\n   \u2502\\n   \u2502\\n   Z\\n*/\\n```\\n\\n$$\\nz_2\\n   = len \\\\times \\\\cos(\\\\alpha+\\\\beta)\\n   = len \\\\times (\\\\cos(\\\\alpha)\\\\cos(\\\\beta) - \\\\sin(\\\\alpha)\\\\sin(\\\\beta))\\n   = len \\\\times \\\\cos(\\\\alpha) \\\\times \\\\cos(\\\\beta) - len \\\\times \\\\sin(\\\\alpha) \\\\times \\\\sin(\\\\beta)\\n   = z_1 \\\\times \\\\cos(\\\\beta) - x_1 \\\\times \\\\sin(\\\\beta)\\n$$\\n\\n$$\\nx_2\\n   = len \\\\times \\\\sin(\\\\alpha+\\\\beta)\\n   = len \\\\times (\\\\sin(\\\\alpha)\\\\cos(\\\\beta) + \\\\cos(\\\\alpha)\\\\sin(\\\\beta))\\n   = len \\\\times \\\\sin(\\\\alpha) \\\\times \\\\cos(\\\\beta) + len \\\\times \\\\cos(\\\\alpha) \\\\times \\\\sin(\\\\beta)\\n   = x_1 \\\\times \\\\cos(\\\\beta) + z_1 \\\\times \\\\sin(\\\\beta)\\n$$\\n\\n$$\\n\\\\overrightarrow{vec_2} =\\n\\\\begin{bmatrix}\\n{c} & 0 & {-s} & 0 \\\\\\\\\\n0   & 1 & 0    & 0 \\\\\\\\\\n{s} & 0 & {c}  & 0 \\\\\\\\\\n0   & 0 & 0    & 1 \\\\\\\\\\n\\\\end{bmatrix}\\n\\\\times \\\\overrightarrow{vec_1}\\n$$"},{"id":"/webgl/\u901a\u8fc7\u70b9\u51fb\u4e8b\u4ef6\u83b7\u53d6WebGL\u5b9a\u4f4d","metadata":{"permalink":"/blog/webgl/\u901a\u8fc7\u70b9\u51fb\u4e8b\u4ef6\u83b7\u53d6WebGL\u5b9a\u4f4d","source":"@site/blog/webgl/\u901a\u8fc7\u70b9\u51fb\u4e8b\u4ef6\u83b7\u53d6WebGL\u5b9a\u4f4d.mdx","title":"\u901a\u8fc7\u70b9\u51fb\u4e8b\u4ef6\u83b7\u53d6 WebGL \u5b9a\u4f4d","description":"\u5dee\u5f02","date":"2021-09-27T09:56:04.000Z","tags":[],"readingTime":1.48,"hasTruncateMarker":false,"authors":[{"name":"Li Yi Gang","title":"Maintainer of BestLyg","url":"https://github.com/bestlyg","imageURL":"https://github.com/bestlyg.png","key":"lyg"}],"frontMatter":{"authors":["lyg"]},"unlisted":false,"prevItem":{"title":"\u65cb\u8f6c","permalink":"/blog/webgl/\u65cb\u8f6c"},"nextItem":{"title":"Git \u76f8\u5173","permalink":"/blog/\u5e38\u89c1\u6280\u5de7/git"}},"content":"## \u5dee\u5f02\\n\\n### CANVAS DOM\\n\\n- \u539f\u70b9\uff1aDOM \u5143\u7d20\u7684\u5de6\u4e0a\u89d2\\n- 1 \u4e2a\u5355\u4f4d\uff1a1 \u4e2a\u50cf\u7d20\\n- x \u8f74\uff1a\u6c34\u5e73\u5411\u53f3\\n- y \u8f74\uff1a\u6c34\u5e73\u5411\u4e0b\\n\\n### WEBGL\\n\\n- \u539f\u70b9\uff1aCANVAS \u4e2d\u5fc3\u70b9\\n- 1 \u4e2a\u5355\u4f4d\u7684\u5bbd\uff1acanvas \u5bbd\u5ea6\u7684\u4e00\u534a\\n- 1 \u4e2a\u5355\u4f4d\u7684\u957f\uff1acanvas \u957f\u5ea6\u7684\u4e00\u534a\\n- x \u8f74\uff1a\u6c34\u5e73\u5411\u53f3\\n- y \u8f74\uff1a\u6c34\u5e73\u5411\u4e0a\\n- z \u8f74\uff1a\u6c34\u5e73\u5411\u5c4f\u5e55\u5916\\n\\n## \u8f6c\u6362\u65b9\u6cd5\\n\\n1. \u76d1\u542c canvas \u5143\u7d20\u7684\u70b9\u51fb\u4e8b\u4ef6\\n1. \u89e6\u53d1\u70b9\u51fb\u4e8b\u4ef6\u540e\u83b7\u53d6\u53c2\u6570\\n   - **clientX** \u9f20\u6807\u57fa\u4e8e\u6d4f\u89c8\u5668\u5de6\u4e0a\u89d2\u7684\u6c34\u5e73\u50cf\u7d20\u8ddd\u79bb\\n   - **clientY** \u9f20\u6807\u57fa\u4e8e\u6d4f\u89c8\u5668\u5de6\u4e0a\u89d2\u7684\u5782\u76f4\u50cf\u7d20\u8ddd\u79bb\\n1. \u901a\u8fc7 canvas \u5143\u7d20\u83b7\u53d6\u53c2\u6570\\n   - **top** dom \u5143\u7d20\u57fa\u4e8e\u6d4f\u89c8\u5668\u5de6\u4e0a\u89d2\u7684\u5782\u76f4\u50cf\u7d20\u8ddd\u79bb\\n   - **left** dom \u5143\u7d20\u57fa\u4e8e\u6d4f\u89c8\u5668\u5de6\u4e0a\u89d2\u7684\u6c34\u5e73\u50cf\u7d20\u8ddd\u79bb\\n   - **width** dom \u5143\u7d20\u7684\u5bbd\\n   - **height** dom \u5143\u7d20\u7684\u9ad8\\n1. \u8ba1\u7b97\u9f20\u6807\u57fa\u4e8e DOM \u5de6\u4e0a\u89d2\u7684\u53c2\u6570\\n   - **x = clientX - left** \u9f20\u6807\u57fa\u4e8e DOM \u5de6\u4e0a\u89d2\u7684\u6c34\u5e73\u50cf\u7d20\u8ddd\u79bb\\n   - **y = clientY - top** \u9f20\u6807\u57fa\u4e8e DOM \u5de6\u4e0a\u89d2\u7684\u5782\u76f4\u50cf\u7d20\u8ddd\u79bb\\n1. \u8f6c\u5316\u4e3a\u5728 webgl \u4e2d\u7684\u53c2\u6570\\n   - **x = (x - width) / width**\\n   - **y = -(y - height) / height** y \u8f74\u65b9\u5411\u8981\u53d6\u53cd"},{"id":"/\u5e38\u89c1\u6280\u5de7/git","metadata":{"permalink":"/blog/\u5e38\u89c1\u6280\u5de7/git","source":"@site/blog/\u5e38\u89c1\u6280\u5de7/git.mdx","title":"Git \u76f8\u5173","description":"\u5f00\u542f\u5927\u5c0f\u5199\u533a\u5206","date":"2021-04-15T03:18:45.000Z","tags":[],"readingTime":1.015,"hasTruncateMarker":false,"authors":[{"name":"Li Yi Gang","title":"Maintainer of BestLyg","url":"https://github.com/bestlyg","imageURL":"https://github.com/bestlyg.png","key":"lyg"}],"frontMatter":{"authors":["lyg"]},"unlisted":false,"prevItem":{"title":"\u901a\u8fc7\u70b9\u51fb\u4e8b\u4ef6\u83b7\u53d6 WebGL \u5b9a\u4f4d","permalink":"/blog/webgl/\u901a\u8fc7\u70b9\u51fb\u4e8b\u4ef6\u83b7\u53d6WebGL\u5b9a\u4f4d"},"nextItem":{"title":"\u6784\u5efa ACI \u7801\u6587\u672c\u5b57","permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u6784\u5efaACI\u7801\u6587\u672c\u5b57"}},"content":"## \u5f00\u542f\u5927\u5c0f\u5199\u533a\u5206\\n\\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b git \u662f\u5ffd\u7565\u533a\u5206\u5927\u5c0f\u5199\u7684\uff0c\u591a\u4eba\u5408\u4f5c\u7684\u60c5\u51b5\u4e0b\u4e0d\u89c4\u8303\u5f88\u5bb9\u6613\u9020\u6210\u95ee\u9898\uff0c\u6240\u4ee5\u5f00\u542f\u533a\u5206\u5927\u5c0f\u5199\u3002\\n\\n- \u5168\u5c40\u5f00\u542f`git config --global core.ignorecase false`\\n- \u53ef\u4ee5\u901a\u8fc7`git config --list`\u67e5\u770b\u914d\u7f6e\u4e2d\u662f\u5426\u5305\u542b`core.ignorecase=false`\u6765\u786e\u8ba4\u662f\u5426\u5f00\u542f\\n\\n## \u64a4\u9500 commit\\n\\n\u5728 commit \u540e\u60f3\u64a4\u56de\\n\\n- \u64a4\u56de\u6700\u65b0\u4e00\u6b21 commit`git reset --soft HEAD^`\\n- \u64a4\u56de\u6700\u65b0 N \u6b21 commit`git reset --soft HEAD~N`\\n- \u4e0d\u5220\u9664\u5de5\u4f5c\u7a7a\u95f4\u6539\u52a8\u4ee3\u7801\uff0c\u64a4\u9500 commit\uff0c\u4e0d\u64a4\u9500 git add . `--soft`\\n- \u5220\u9664\u5de5\u4f5c\u7a7a\u95f4\u6539\u52a8\u4ee3\u7801\uff0c\u64a4\u9500 commit\uff0c\u64a4\u9500 git add . `--hard`\\n- \u53ea\u4fee\u6539\u6ce8\u91ca`git commit --amend`\\n\\n## \u540c\u65f6\u63a8\u9001\u591a\u4e2a\u4ed3\u5e93\\n\\n- \u8bbe\u7f6e\u7b2c\u4e8c\u4e2a\u4ed3\u5e93\u5730\u5740`git remote set-url --add origin \u4f60\u7684\u7801\u4e91\u5730\u5740`\\n- \u540c\u65f6\u63a8\u9001`git push -u origin main`"},{"id":"/\u5e38\u89c1\u6280\u5de7/\u6784\u5efaACI\u7801\u6587\u672c\u5b57","metadata":{"permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u6784\u5efaACI\u7801\u6587\u672c\u5b57","source":"@site/blog/\u5e38\u89c1\u6280\u5de7/\u6784\u5efaACI\u7801\u6587\u672c\u5b57.mdx","title":"\u6784\u5efa ACI \u7801\u6587\u672c\u5b57","description":"\u6784\u5efa\u4e00\u5199\u5229\u7528\u7b26\u53f7\u7ec4\u6210\u7684\u5b57","date":"2021-04-15T03:02:01.000Z","tags":[],"readingTime":0.51,"hasTruncateMarker":false,"authors":[{"name":"Li Yi Gang","title":"Maintainer of BestLyg","url":"https://github.com/bestlyg","imageURL":"https://github.com/bestlyg.png","key":"lyg"}],"frontMatter":{"authors":["lyg"]},"unlisted":false,"prevItem":{"title":"Git \u76f8\u5173","permalink":"/blog/\u5e38\u89c1\u6280\u5de7/git"},"nextItem":{"title":"\u7ed3\u675f\u5360\u7528\u8fdb\u7a0b","permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u7ed3\u675f\u5360\u7528\u8fdb\u7a0b"}},"content":"\u6784\u5efa\u4e00\u5199\u5229\u7528\u7b26\u53f7\u7ec4\u6210\u7684\u5b57\\n\\n- [\u8df3\u8f6c\u7f51\u5740](http://patorjk.com/software/taag/)\\n\\n```\\n***********************************************************\\n*      ____  ______  _____ _______ _  __     _______      *\\n*     |  _ \\\\|  ____|/ ____|__   __| | \\\\ \\\\   / / ____|     *\\n*     | |_) | |__  | (___    | |  | |  \\\\ \\\\_/ / |  __      *\\n*     |  _ <|  __|  \\\\___ \\\\   | |  | |   \\\\   /| | |_ |     *\\n*     | |_) | |____ ____) |  | |  | |____| | | |__| |     *\\n*     |____/|______|_____/   |_|  |______|_|  \\\\_____|     *\\n*                                                         *\\n***********************************************************\\n```"},{"id":"/\u5e38\u89c1\u6280\u5de7/\u7ed3\u675f\u5360\u7528\u8fdb\u7a0b","metadata":{"permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u7ed3\u675f\u5360\u7528\u8fdb\u7a0b","source":"@site/blog/\u5e38\u89c1\u6280\u5de7/\u7ed3\u675f\u5360\u7528\u8fdb\u7a0b.mdx","title":"\u7ed3\u675f\u5360\u7528\u8fdb\u7a0b","description":"windows","date":"2021-04-09T02:27:00.000Z","tags":[],"readingTime":0.235,"hasTruncateMarker":false,"authors":[{"name":"Li Yi Gang","title":"Maintainer of BestLyg","url":"https://github.com/bestlyg","imageURL":"https://github.com/bestlyg.png","key":"lyg"}],"frontMatter":{"authors":["lyg"]},"unlisted":false,"prevItem":{"title":"\u6784\u5efa ACI \u7801\u6587\u672c\u5b57","permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u6784\u5efaACI\u7801\u6587\u672c\u5b57"},"nextItem":{"title":"\u4e0b\u8f7d","permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u4e0b\u8f7d"}},"content":"## windows\\n\\n- \u67e5\u770b\u88ab\u5360\u7528\u7684\u7aef\u53e3\u53f7\u7684 PID\\n  `netstat -aon | findstr \u7aef\u53e3\u53f7`\\n- \u67e5\u770b\u88ab\u5360\u7528\u7684\u8fdb\u7a0b\\n  `tasklist | findstr \u8fdb\u7a0bPID`\\n- \u7ed3\u675f\u8fdb\u7a0b\\n  `taskkill /f /t /im \u8fdb\u7a0bID`"},{"id":"/\u5e38\u89c1\u6280\u5de7/\u4e0b\u8f7d","metadata":{"permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u4e0b\u8f7d","source":"@site/blog/\u5e38\u89c1\u6280\u5de7/\u4e0b\u8f7d.mdx","title":"\u4e0b\u8f7d","description":"\u666e\u901a\u4e0b\u8f7d\u6587\u4ef6","date":"2021-04-08T12:14:17.000Z","tags":[],"readingTime":0.405,"hasTruncateMarker":false,"authors":[{"name":"Li Yi Gang","title":"Maintainer of BestLyg","url":"https://github.com/bestlyg","imageURL":"https://github.com/bestlyg.png","key":"lyg"}],"frontMatter":{"authors":["lyg"]},"unlisted":false,"prevItem":{"title":"\u7ed3\u675f\u5360\u7528\u8fdb\u7a0b","permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u7ed3\u675f\u5360\u7528\u8fdb\u7a0b"},"nextItem":{"title":"Node \u5185\u5b58\u6ea2\u51fa","permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u5185\u5b58\u6ea2\u51fa"}},"content":"## \u666e\u901a\u4e0b\u8f7d\u6587\u4ef6\\n\\n```js\\nwindow.open(url, \'_blank\');\\n```\\n\\n## \u4e0b\u8f7d\u622a\u56fe\\n\\n\u4f7f\u7528**html2canvas**\u628a html \u5bb9\u5668\u8f6c\u6362\u4e3a canvas  \\n\u4f7f\u7528**canvas2image**\u628a canvas \u8f6c\u6362\u4e3a\u56fe\u7247  \\n`yarn add html2canvas canvas2image`\\n\\n```js\\nconst container = document.querySelector(\'#container\');\\nhtml2canvas(container).then(canvas => {\\n  canvas2image.saveAsImage(canvas, container.clientWidth, container.clientHeight, \'jpeg\');\\n});\\n```\\n\\n### \u95ee\u9898\uff1a\u65e0\u6cd5\u622a\u53d6 img \u6807\u7b7e\u5185\u8d44\u6e90\\n\\n\u9700\u914d\u7f6e html2canvas \u8d44\u6e90\u8de8\u57df\\n`html2canvas(container, { useCORS: true })`"},{"id":"/\u5e38\u89c1\u6280\u5de7/\u5185\u5b58\u6ea2\u51fa","metadata":{"permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u5185\u5b58\u6ea2\u51fa","source":"@site/blog/\u5e38\u89c1\u6280\u5de7/\u5185\u5b58\u6ea2\u51fa.mdx","title":"Node \u5185\u5b58\u6ea2\u51fa","description":"\u4f7f\u7528 Node \u65f6\uff0c\u5982\u679c\u6570\u636e\u91cf\u8fc7\u5927\uff0c\u4f1a\u5185\u5b58\u6ea2\u51fa\u3002","date":"2021-04-08T12:14:17.000Z","tags":[],"readingTime":0.21,"hasTruncateMarker":false,"authors":[{"name":"Li Yi Gang","title":"Maintainer of BestLyg","url":"https://github.com/bestlyg","imageURL":"https://github.com/bestlyg.png","key":"lyg"}],"frontMatter":{"authors":["lyg"]},"unlisted":false,"prevItem":{"title":"\u4e0b\u8f7d","permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u4e0b\u8f7d"},"nextItem":{"title":"\u9879\u76ee\u6784\u5efa","permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u9879\u76ee\u6784\u5efa"}},"content":"\u4f7f\u7528 Node \u65f6\uff0c\u5982\u679c\u6570\u636e\u91cf\u8fc7\u5927\uff0c\u4f1a\u5185\u5b58\u6ea2\u51fa\u3002\\n\\n\u53ef\u4ee5\u5229\u7528*increase-memory-limit*\u8fdb\u884c\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\u9650\u5236\u7684\u63d0\u5347\\n\\n`yarn add cross-env increase-memory-limit -D`\\n`cross-env LIMIT=8192 increase-memory-limit`"},{"id":"/\u5e38\u89c1\u6280\u5de7/\u9879\u76ee\u6784\u5efa","metadata":{"permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u9879\u76ee\u6784\u5efa","source":"@site/blog/\u5e38\u89c1\u6280\u5de7/\u9879\u76ee\u6784\u5efa.mdx","title":"\u9879\u76ee\u6784\u5efa","description":"\u9879\u76ee\u6784\u5efa\u5e38\u7528\u5e93","date":"2021-04-08T12:14:17.000Z","tags":[],"readingTime":4.805,"hasTruncateMarker":false,"authors":[{"name":"Li Yi Gang","title":"Maintainer of BestLyg","url":"https://github.com/bestlyg","imageURL":"https://github.com/bestlyg.png","key":"lyg"}],"frontMatter":{"authors":["lyg"]},"unlisted":false,"prevItem":{"title":"Node \u5185\u5b58\u6ea2\u51fa","permalink":"/blog/\u5e38\u89c1\u6280\u5de7/\u5185\u5b58\u6ea2\u51fa"}},"content":"## \u9879\u76ee\u6784\u5efa\u5e38\u7528\u5e93\\n\\n## Gzip\\n\\nwebpack \u4f9d\u8d56\u5e93  \\n`yarn add compression-webpack-plugin -D`  \\n\u7531\u4e8e\u7248\u672c\u66f4\u65b0\u95ee\u9898\uff0cwebpack4 \u4f7f\u7528\u65f6\u9700\u5b89\u88c5\u4f4e\u7248\u672c  \\n`yarn add compression-webpack-plugin@6. -D`\\n\\n\u4f7f\u7528\u65b9\u6848\\n\\n```js\\n// umi & dumi\\n{\\n  chainWebpack(config, { webpack }) {\\n    // \u751f\u4ea7\u6a21\u5f0f\u5f00\u542f\\n    config.plugin(\'compression-webpack-plugin\').use(\\n      new CompressionWebpackPlugin({\\n        // filename: \u6587\u4ef6\u540d\u79f0\uff0c\u8fd9\u91cc\u6211\u4eec\u4e0d\u8bbe\u7f6e\uff0c\u8ba9\u5b83\u4fdd\u6301\u548c\u672a\u538b\u7f29\u7684\u6587\u4ef6\u540c\u4e00\u4e2a\u540d\u79f0\\n        algorithm: \'gzip\', // \u6307\u5b9a\u751f\u6210gzip\u683c\u5f0f\\n        test: new RegExp(`.(${[\'js\', \'css\'].join(\'|\')})$`), // \u5339\u914d\u54ea\u4e9b\u683c\u5f0f\u6587\u4ef6\u9700\u8981\u538b\u7f29\\n        threshold: 1024 * 10, //\u5bf9\u8d85\u8fc710k\u7684\u6570\u636e\u8fdb\u884c\u538b\u7f29\\n        minRatio: 0.6, // \u538b\u7f29\u6bd4\u4f8b\uff0c\u503c\u4e3a0 ~ 1\\n      })\\n    );\\n  }\\n}\\n```\\n\\n### commitizen\\n\\n- \u9879\u76ee\u89c4\u8303\u63d0\u4ea4\u5e93\\n- \u5b89\u88c5\u540e\u9700\u6267\u884c\u4e00\u6b21`commitizen init cz-conventional-changelog --save-dev --save-exact`\u8fdb\u884c\u521d\u59cb\u5316\\n- \u521d\u59cb\u5316\u6210\u529f\u540e\u53ef`git-cz`\u8fdb\u884c\u63d0\u4ea4\\n- \u521d\u59cb\u5316\u547d\u4ee4\u4e3b\u8981\u8fdb\u884c\u4e86 3 \u4ef6\u4e8b\u60c5  \\n  1.\u5728\u9879\u76ee\u4e2d\u5b89\u88c5 cz-conventional-changelog \u9002\u914d\u5668\u4f9d\u8d56  \\n  2.\u5c06\u9002\u914d\u5668\u4f9d\u8d56\u4fdd\u5b58\u5230 package.json \u7684 devDependencies \u5b57\u6bb5\u4fe1\u606f  \\n  3.\u5728 package.json \u4e2d\u65b0\u589e config.commitizen \u5b57\u6bb5\u4fe1\u606f\uff0c\u4e3b\u8981\u7528\u4e8e\u914d\u7f6e cz \u5de5\u5177\u7684\u9002\u914d\u5668\u8def\u5f84\uff1a\\n\\n```json\\n\\"devDependencies\\": {\\n    \\"cz-conventional-changelog\\": \\"^2.1.0\\"\\n},\\n\\"config\\": {\\n    \\"commitizen\\": {\\n      \\"path\\": \\"./node_modules/cz-conventional-changelog\\"\\n    }\\n}\\n```\\n\\n### cz-customizable\\n\\n- \u901a\u8fc7\u5728\u6839\u76ee\u5f55\u7f16\u5199`.cz-config.js`\u6587\u4ef6\u8fdb\u884c\u81ea\u5b9a\u4e49`git-cz`\u9879\u76ee\u63d0\u4ea4\u683c\u5f0f\\n- \u4e00\u4efd\u793a\u4f8b\\n\\n```js\\n\'use strict\';\\n\\nmodule.exports = {\\n  types: [\\n    { value: \'\u7279\u6027\', name: \'\u7279\u6027:    \u4e00\u4e2a\u65b0\u7684\u7279\u6027\' },\\n    { value: \'\u4fee\u590d\', name: \'\u4fee\u590d:    \u4fee\u590d\u4e00\u4e2aBug\' },\\n    { value: \'\u6587\u6863\', name: \'\u6587\u6863:    \u53d8\u66f4\u7684\u53ea\u6709\u6587\u6863\' },\\n    { value: \'\u683c\u5f0f\', name: \'\u683c\u5f0f:    \u7a7a\u683c, \u5206\u53f7\u7b49\u683c\u5f0f\u4fee\u590d\' },\\n    { value: \'\u91cd\u6784\', name: \'\u91cd\u6784:    \u4ee3\u7801\u91cd\u6784\uff0c\u6ce8\u610f\u548c\u7279\u6027\u3001\u4fee\u590d\u533a\u5206\u5f00\' },\\n    { value: \'\u6027\u80fd\', name: \'\u6027\u80fd:    \u63d0\u5347\u6027\u80fd\' },\\n    { value: \'\u6d4b\u8bd5\', name: \'\u6d4b\u8bd5:    \u6dfb\u52a0\u4e00\u4e2a\u6d4b\u8bd5\' },\\n    { value: \'\u5de5\u5177\', name: \'\u5de5\u5177:    \u5f00\u53d1\u5de5\u5177\u53d8\u52a8(\u6784\u5efa\u3001\u811a\u624b\u67b6\u5de5\u5177\u7b49)\' },\\n    { value: \'\u56de\u6eda\', name: \'\u56de\u6eda:    \u4ee3\u7801\u56de\u9000\' },\\n  ],\\n  scopes: [{ name: \'\u4e2a\u4eba\u535a\u5ba2\' }, { name: \'\u529b\u6263\u9898\u89e3\' }, { name: \'\u5e94\u7528\u5408\u96c6\' }, { name: \'\u914d\u7f6e\u6587\u4ef6\' }],\\n  // it needs to match the value for field type. Eg.: \'fix\'\\n  /*\\n  scopeOverrides: {\\n    fix: [\\n      {name: \'merge\'},\\n      {name: \'style\'},\\n      {name: \'e2eTest\'},\\n      {name: \'unitTest\'}\\n    ]\\n  },\\n  */\\n  // override the messages, defaults are as follows\\n  messages: {\\n    type: \'\u9009\u62e9\u4e00\u79cd\u4f60\u7684\u63d0\u4ea4\u7c7b\u578b:\',\\n    scope: \'\u9009\u62e9\u4e00\u4e2ascope (\u53ef\u9009):\',\\n    // used if allowCustomScopes is true\\n    customScope: \'Denote the SCOPE of this change:\',\\n    subject: \'\u77ed\u8bf4\u660e:\\\\n\',\\n    body: \'\u957f\u8bf4\u660e\uff0c\u4f7f\u7528\\"|\\"\u6362\u884c(\u53ef\u9009)\uff1a\\\\n\',\\n    breaking: \'\u975e\u517c\u5bb9\u6027\u8bf4\u660e (\u53ef\u9009):\\\\n\',\\n    footer: \'\u5173\u8054\u5173\u95ed\u7684issue\uff0c\u4f8b\u5982\uff1a#31, #34(\u53ef\u9009):\\\\n\',\\n    confirmCommit: \'\u786e\u5b9a\u63d0\u4ea4\u8bf4\u660e?\',\\n  },\\n\\n  allowCustomScopes: true,\\n  allowBreakingChanges: [\'\u7279\u6027\', \'\u4fee\u590d\'],\\n  // limit subject length\\n  subjectLimit: 100,\\n};\\n```\\n\\n### @commitlint/cli\\n\\ncommit \u683c\u5f0f\u6821\u9a8c\u5668\\n\\n### @commitlint/config-conventional\\n\\n- commit angular \u683c\u5f0f\u6821\u9a8c\u89c4\u5219\\n- \u5728\u9879\u76ee\u4e2d\u65b0\u5efa`commitlint.config.js`\u6587\u4ef6\u5e76\u8bbe\u7f6e\u6821\u9a8c\u89c4\u5219\\n\\n```js\\nmodule.exports = {\\n  extends: [\'@commitlint/config-conventional\'],\\n};\\n```\\n\\n### commitlint-config-cz\\n\\n- \u5982\u679c\u662f\u4f7f\u7528 cz-customizable \u9002\u914d\u5668\u505a\u4e86\u7834\u574f Angular \u98ce\u683c\u7684\u63d0\u4ea4\u8bf4\u660e\u914d\u7f6e\uff0c\u90a3\u4e48\u4e0d\u80fd\u4f7f\u7528`@commitlint/config-conventional`\u89c4\u5219\u8fdb\u884c\u63d0\u4ea4\u8bf4\u660e\u6821\u9a8c\\n- \u53ef\u4ee5\u4f7f\u7528`commitlint-config-cz`\u5bf9\u5b9a\u5236\u5316\u63d0\u4ea4\u8bf4\u660e\u8fdb\u884c\u6821\u9a8c\u3002\u7136\u540e\u5728\u9879\u76ee\u4e2d\u65b0\u5efa`commitlint.config.js`\u6587\u4ef6\u5e76\u8bbe\u7f6e\u6821\u9a8c\u89c4\u5219\u52a0\u5165 commitlint \u6821\u9a8c\u89c4\u5219\u914d\u7f6e\uff1a\\n\\n```js\\nmodule.exports = {\\n  extends: [\'cz\'],\\n};\\n```\\n\\n### conventional-changelog-cli\\n\\n- \u751f\u6210*CHANGELOG.md*\u6587\u4ef6\\n- \u8ffd\u52a0`conventional-changelog -p angular -i CHANGELOG.md -s`\\n- \u8986\u76d6`conventional-changelog -p angular -i CHANGELOG.md -s -r 0`\\n- _\u4f7f\u7528 cz-customizable \u81ea\u5b9a\u4e49\u914d\u7f6e\u540e\u7834\u574f angular \u89c4\u5219\u540e\u4f1a\u5931\u6548_,\u9700\u5728 cli \u4e2d\u5220\u9664 angular \u914d\u7f6e\\n\\n### standard-version\\n\\n- \u66f4\u65b0\u7248\u672c\u53f7 [github](https://github.com/conventional-changelog/standard-version)\\n- \u5e38\u7528\u547d\u4ee4\\n  - `standard-version -r major`\\n  - `standard-version -r minor`\\n  - `standard-version -r patch`\\n\\n### semver\\n\\n\u66f4\u65b0\u7248\u672c\u53f7\\n\\n```js\\nimport { minimist, pkg, semver, enquirer, chalk, fs, resolve } from \'../utils\';\\n\\nconst args = minimist(process.argv.slice(2));\\nconst currentVersion = pkg.version;\\n\\nconst preId =\\n  args.preid || (semver.prerelease(currentVersion) && semver.prerelease(currentVersion)?.[0]);\\nconst versionIncrements: semver.ReleaseType[] = [\\n  \'major\',\\n  \'minor\',\\n  \'patch\',\\n  ...((preId ? [\'prepatch\', \'preminor\', \'premajor\', \'prerelease\'] : []) as semver.ReleaseType[]),\\n];\\nconst inc = (i: semver.ReleaseType) => semver.inc(currentVersion, i, preId);\\nasync function main() {\\n  const { release } = (await enquirer.prompt({\\n    type: \'select\',\\n    name: \'release\',\\n    message: \'\u9009\u62e9\u4e0b\u4e00\u7248\u672c\',\\n    choices: versionIncrements.map(i => `${i} (${inc(i)})`),\\n  })) as { release: string };\\n  const targetVersion = release.match(/\\\\((.*)\\\\)/)![1];\\n  console.log(chalk.blue(`\u4e0b\u4e00\u7248\u672c : ${targetVersion}`));\\n  pkg.version = targetVersion;\\n  fs.writeFileSync(resolve(\'package.json\'), JSON.stringify(pkg, null, 2) + \'\\\\n\');\\n}\\nmain();\\n```"}]}}')}}]);
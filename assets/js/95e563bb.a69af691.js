"use strict";(self.webpackChunk_bestlyg_site=self.webpackChunk_bestlyg_site||[]).push([[37462],{1151:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>v,contentTitle:()=>w,default:()=>D,frontMatter:()=>x,metadata:()=>b,toc:()=>j});var a=t(86070),i=t(25710),o=t(30758),s=t(9488),r=t(71828),l=t(2942),d=t(50712),c=t(46034),g=t(49836);const h="undefined"==typeof window;function m(e){if(h)return[];const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const t=n.getContext("2d");t.drawImage(e,0,0,e.width,e.height);return t.getImageData(0,0,e.width,e.height).data}function u(){const[e,n]=(0,o.useState)(null),t=(0,o.useRef)(),[i,u]=(0,o.useState)({imageData:[],image:h?null:new Image,blurPx:0});return(0,o.useEffect)((()=>{if(console.log("Input File",e),!e||!t.current)return;const n=URL.createObjectURL(e),a=new Image;a.src=n,new Promise(((e,n)=>{a.onload=()=>{console.log("image load success",a,a.width,a.height),s.Ay.success(`image load success, width : ${a.width} height : ${a.height}`),e()},a.onerror=e=>{console.log("image load error",e),s.Ay.error(`image load error, ${e.toString()}`),n()}})).then((()=>{u({image:a,imageData:Array.from(m(a)),blurPx:0})}))}),[e]),(0,o.useLayoutEffect)((()=>{if(!t.current)return;console.log("options",i);const{image:e,imageData:n}=i,a=t.current;a.style.marginRight=e.width+"px",a.style.marginBottom=e.height+"px";const o=[];for(let t=0;t<n.length;t+=4){const[a,s,r,l]=[n[t],n[t+1],n[t+2],n[t+3]],[d,c]=[t/4%e.width,Math.floor(t/4/e.width)];o.push(`${d}px ${c}px  ${i.blurPx}px 1px rgba(${a}, ${s}, ${r}, ${l/255})`)}a.style.boxShadow=o.join(",")}),[i]),(0,a.jsxs)(r.A,{direction:"vertical",children:[(0,a.jsx)(l.A,{showUploadList:!1,beforeUpload:e=>(n(e),!1),maxCount:1,listType:"picture",children:(0,a.jsx)(d.Ay,{icon:(0,a.jsx)(g.A,{}),children:"Select File"})}),(0,a.jsx)(c.A,{min:0,addonBefore:"blurPx",addonAfter:"px",value:i.blurPx,onChange:e=>{u({...i,blurPx:e})}}),(0,a.jsx)("div",{ref:t,id:"image2Shadow",style:{width:0,height:0}})]})}const f="import React, { useState, useEffect, useRef, useLayoutEffect } from 'react';\nimport { Upload, Button, Space, message, InputNumber } from 'antd';\nimport { UploadOutlined } from '@ant-design/icons';\nimport { isServer } from '@site/src/utils';\n\nfunction getImageData(image: HTMLImageElement) {\n    if (isServer) return [];\n    const canvas = document.createElement('canvas');\n    canvas.width = image.width;\n    canvas.height = image.height;\n    const ctx = canvas.getContext('2d');\n    ctx.drawImage(image, 0, 0, image.width, image.height);\n    const imageData = ctx.getImageData(0, 0, image.width, image.height).data;\n    return imageData;\n}\n\nexport function Image2Shadow() {\n    const [file, setFile] = useState<File | null>(null);\n    const shadowRef = useRef<HTMLDivElement>();\n    const [options, setOptions] = useState<{\n        imageData: number[];\n        image: HTMLImageElement;\n        blurPx: number;\n    }>({\n        imageData: [],\n        image: isServer ? null : new Image(),\n        blurPx: 0,\n    });\n    useEffect(() => {\n        console.log('Input File', file);\n        if (!file || !shadowRef.current) return;\n        const url = URL.createObjectURL(file);\n        const image = new Image();\n        image.src = url;\n        new Promise<void>((resolve, reject) => {\n            image.onload = () => {\n                console.log('image load success', image, image.width, image.height);\n                message.success(\n                    `image load success, width : ${image.width} height : ${image.height}`,\n                );\n                resolve();\n            };\n            image.onerror = e => {\n                console.log('image load error', e);\n                message.error(`image load error, ${e.toString()}`);\n                reject();\n            };\n        }).then(() => {\n            setOptions({\n                image,\n                imageData: Array.from(getImageData(image)),\n                blurPx: 0,\n            });\n        });\n    }, [file]);\n\n    useLayoutEffect(() => {\n        if (!shadowRef.current) return;\n        console.log('options', options);\n        const { image, imageData } = options;\n        const dom: HTMLDivElement = shadowRef.current;\n        dom.style.marginRight = image.width + 'px';\n        dom.style.marginBottom = image.height + 'px';\n        const shadowlist: string[] = [];\n        for (let i = 0; i < imageData.length; i += 4) {\n            const [r, g, b, a] = [\n                imageData[i],\n                imageData[i + 1],\n                imageData[i + 2],\n                imageData[i + 3],\n            ];\n            const [widthOffset, heightOffset] = [\n                (i / 4) % image.width,\n                Math.floor(i / 4 / image.width),\n            ];\n            shadowlist.push(\n                `${widthOffset}px ${heightOffset}px  ${\n                    options.blurPx\n                }px 1px rgba(${r}, ${g}, ${b}, ${a / 255})`,\n            );\n        }\n        dom.style.boxShadow = shadowlist.join(',');\n    }, [options]);\n\n    return (\n        <Space direction=\"vertical\">\n            <Upload\n                showUploadList={false}\n                beforeUpload={file => {\n                    setFile(file);\n                    return false;\n                }}\n                maxCount={1}\n                listType=\"picture\"\n            >\n                <Button icon={<UploadOutlined />}>Select File</Button>\n            </Upload>\n            <InputNumber\n                min={0}\n                addonBefore=\"blurPx\"\n                addonAfter=\"px\"\n                value={options.blurPx}\n                onChange={blurPx => {\n                    setOptions({ ...options, blurPx });\n                }}\n            />\n            <div ref={shadowRef} id=\"image2Shadow\" style={{ width: 0, height: 0 }}></div>\n        </Space>\n    );\n}\n";var p=t(82598);const x={},w="\u56fe\u50cf\u8f6c\u9634\u5f71",b={id:"\u5e94\u7528/image2shadow",title:"\u56fe\u50cf\u8f6c\u9634\u5f71",description:"\u539f\u7406",source:"@site/docs/\u5e94\u7528/image2shadow.mdx",sourceDirName:"\u5e94\u7528",slug:"/\u5e94\u7528/image2shadow",permalink:"/docs/\u5e94\u7528/image2shadow",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"journal",previous:{title:"\u76ee\u5f55\u7d22\u5f15",permalink:"/docs/\u5e94\u7528/"},next:{title:"\u8d26\u672c",permalink:"/docs/\u5e94\u7528/ledger"}},v={},j=[{value:"\u539f\u7406",id:"\u539f\u7406",level:2},{value:"Code",id:"code",level:2}];function y(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"\u56fe\u50cf\u8f6c\u9634\u5f71",children:"\u56fe\u50cf\u8f6c\u9634\u5f71"})}),"\n",(0,a.jsx)(u,{}),"\n",(0,a.jsx)(n.h2,{id:"\u539f\u7406",children:"\u539f\u7406"}),"\n",(0,a.jsxs)(n.p,{children:["\u5148\u5229\u7528 canvas \u83b7\u53d6\u5230\u56fe\u7247\u6bcf\u4e00\u4e2a\u70b9\u7684\u989c\u8272\u4fe1\u606f\uff0c \u5229\u7528 dom \u7684",(0,a.jsx)(n.code,{children:"box-shadow"}),"\u53ef\u4ee5\u653e\u7f6e\u4efb\u610f\u4e2a\u9634\u5f71\uff0c \u8ba1\u7b97\u504f\u79fb\u540e\u653e\u7f6e\u6bcf\u4e00\u4e2a\u50cf\u7d20\u70b9\u3002"]}),"\n",(0,a.jsx)(n.h2,{id:"code",children:"Code"}),"\n",(0,a.jsx)(p.A,{language:"tsx",children:f})]})}function D(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(y,{...e})}):y(e)}}}]);
"use strict";(self.webpackChunk_bestlyg_site=self.webpackChunk_bestlyg_site||[]).push([[37462],{51030:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>v,contentTitle:()=>b,default:()=>j,frontMatter:()=>x,metadata:()=>a,toc:()=>y});const a=JSON.parse('{"id":"\u5e94\u7528/image2shadow","title":"\u56fe\u50cf\u8f6c\u9634\u5f71","description":"\u539f\u7406","source":"@site/docs/\u5e94\u7528/image2shadow.mdx","sourceDirName":"\u5e94\u7528","slug":"/\u5e94\u7528/image2shadow","permalink":"/docs/\u5e94\u7528/image2shadow","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"journal","previous":{"title":"\u76ee\u5f55\u7d22\u5f15","permalink":"/docs/\u5e94\u7528/"},"next":{"title":"\u8d26\u672c","permalink":"/docs/\u5e94\u7528/ledger"}}');var i=n(25105),r=n(8556),o=n(58101),s=n(34417),l=n(67168),d=n(92409),c=n(45544),g=n(16376),h=n(64562),m=n(8669);function u(e){if(m.S)return[];const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);return n.getImageData(0,0,e.width,e.height).data}function f(){const[e,t]=(0,o.useState)(null),n=(0,o.useRef)(),[a,r]=(0,o.useState)({imageData:[],image:m.S?null:new Image,blurPx:0});return(0,o.useEffect)((()=>{if(console.log("Input File",e),!e||!n.current)return;const t=URL.createObjectURL(e),a=new Image;a.src=t,new Promise(((e,t)=>{a.onload=()=>{console.log("image load success",a,a.width,a.height),s.Ay.success(`image load success, width : ${a.width} height : ${a.height}`),e()},a.onerror=e=>{console.log("image load error",e),s.Ay.error(`image load error, ${e.toString()}`),t()}})).then((()=>{r({image:a,imageData:Array.from(u(a)),blurPx:0})}))}),[e]),(0,o.useLayoutEffect)((()=>{if(!n.current)return;console.log("options",a);const{image:e,imageData:t}=a,i=n.current;i.style.marginRight=e.width+"px",i.style.marginBottom=e.height+"px";const r=[];for(let n=0;n<t.length;n+=4){const[i,o,s,l]=[t[n],t[n+1],t[n+2],t[n+3]],[d,c]=[n/4%e.width,Math.floor(n/4/e.width)];r.push(`${d}px ${c}px  ${a.blurPx}px 1px rgba(${i}, ${o}, ${s}, ${l/255})`)}i.style.boxShadow=r.join(",")}),[a]),(0,i.jsxs)(l.A,{direction:"vertical",children:[(0,i.jsx)(d.A,{showUploadList:!1,beforeUpload:e=>(t(e),!1),maxCount:1,listType:"picture",children:(0,i.jsx)(c.Ay,{icon:(0,i.jsx)(h.A,{}),children:"Select File"})}),(0,i.jsx)(g.A,{min:0,addonBefore:"blurPx",addonAfter:"px",value:a.blurPx,onChange:e=>{r({...a,blurPx:e})}}),(0,i.jsx)("div",{ref:n,id:"image2Shadow",style:{width:0,height:0}})]})}const p="import React, { useState, useEffect, useRef, useLayoutEffect } from 'react';\nimport { Upload, Button, Space, message, InputNumber } from 'antd';\nimport { UploadOutlined } from '@ant-design/icons';\nimport { isServer } from '@site/src/utils';\n\nfunction getImageData(image: HTMLImageElement) {\n    if (isServer) return [];\n    const canvas = document.createElement('canvas');\n    canvas.width = image.width;\n    canvas.height = image.height;\n    const ctx = canvas.getContext('2d');\n    ctx.drawImage(image, 0, 0, image.width, image.height);\n    const imageData = ctx.getImageData(0, 0, image.width, image.height).data;\n    return imageData;\n}\n\nexport function Image2Shadow() {\n    const [file, setFile] = useState<File | null>(null);\n    const shadowRef = useRef<HTMLDivElement>();\n    const [options, setOptions] = useState<{\n        imageData: number[];\n        image: HTMLImageElement;\n        blurPx: number;\n    }>({\n        imageData: [],\n        image: isServer ? null : new Image(),\n        blurPx: 0,\n    });\n    useEffect(() => {\n        console.log('Input File', file);\n        if (!file || !shadowRef.current) return;\n        const url = URL.createObjectURL(file);\n        const image = new Image();\n        image.src = url;\n        new Promise<void>((resolve, reject) => {\n            image.onload = () => {\n                console.log('image load success', image, image.width, image.height);\n                message.success(\n                    `image load success, width : ${image.width} height : ${image.height}`,\n                );\n                resolve();\n            };\n            image.onerror = e => {\n                console.log('image load error', e);\n                message.error(`image load error, ${e.toString()}`);\n                reject();\n            };\n        }).then(() => {\n            setOptions({\n                image,\n                imageData: Array.from(getImageData(image)),\n                blurPx: 0,\n            });\n        });\n    }, [file]);\n\n    useLayoutEffect(() => {\n        if (!shadowRef.current) return;\n        console.log('options', options);\n        const { image, imageData } = options;\n        const dom: HTMLDivElement = shadowRef.current;\n        dom.style.marginRight = image.width + 'px';\n        dom.style.marginBottom = image.height + 'px';\n        const shadowlist: string[] = [];\n        for (let i = 0; i < imageData.length; i += 4) {\n            const [r, g, b, a] = [\n                imageData[i],\n                imageData[i + 1],\n                imageData[i + 2],\n                imageData[i + 3],\n            ];\n            const [widthOffset, heightOffset] = [\n                (i / 4) % image.width,\n                Math.floor(i / 4 / image.width),\n            ];\n            shadowlist.push(\n                `${widthOffset}px ${heightOffset}px  ${\n                    options.blurPx\n                }px 1px rgba(${r}, ${g}, ${b}, ${a / 255})`,\n            );\n        }\n        dom.style.boxShadow = shadowlist.join(',');\n    }, [options]);\n\n    return (\n        <Space direction=\"vertical\">\n            <Upload\n                showUploadList={false}\n                beforeUpload={file => {\n                    setFile(file);\n                    return false;\n                }}\n                maxCount={1}\n                listType=\"picture\"\n            >\n                <Button icon={<UploadOutlined />}>Select File</Button>\n            </Upload>\n            <InputNumber\n                min={0}\n                addonBefore=\"blurPx\"\n                addonAfter=\"px\"\n                value={options.blurPx}\n                onChange={blurPx => {\n                    setOptions({ ...options, blurPx });\n                }}\n            />\n            <div ref={shadowRef} id=\"image2Shadow\" style={{ width: 0, height: 0 }}></div>\n        </Space>\n    );\n}\n";var w=n(729);const x={},b="\u56fe\u50cf\u8f6c\u9634\u5f71",v={},y=[{value:"\u539f\u7406",id:"\u539f\u7406",level:2},{value:"Code",id:"code",level:2}];function S(e){const t={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"\u56fe\u50cf\u8f6c\u9634\u5f71",children:"\u56fe\u50cf\u8f6c\u9634\u5f71"})}),"\n",(0,i.jsx)(f,{}),"\n",(0,i.jsx)(t.h2,{id:"\u539f\u7406",children:"\u539f\u7406"}),"\n",(0,i.jsxs)(t.p,{children:["\u5148\u5229\u7528 canvas \u83b7\u53d6\u5230\u56fe\u7247\u6bcf\u4e00\u4e2a\u70b9\u7684\u989c\u8272\u4fe1\u606f\uff0c \u5229\u7528 dom \u7684",(0,i.jsx)(t.code,{children:"box-shadow"}),"\u53ef\u4ee5\u653e\u7f6e\u4efb\u610f\u4e2a\u9634\u5f71\uff0c \u8ba1\u7b97\u504f\u79fb\u540e\u653e\u7f6e\u6bcf\u4e00\u4e2a\u50cf\u7d20\u70b9\u3002"]}),"\n",(0,i.jsx)(t.h2,{id:"code",children:"Code"}),"\n",(0,i.jsx)(w.A,{language:"tsx",children:p})]})}function j(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(S,{...e})}):S(e)}},8669:(e,t,n)=>{n.d(t,{S:()=>a,b:()=>s});const a="undefined"==typeof window;var i=n(34417);class r{static of(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new r(...t)}static ofSuccess(e){return new r(0,e)}static ofFailure(e,t){return void 0===t&&(t=1),new r(t,e?.message??e?.toString()??"Server Error")}static from(e){return this.of(0).setCode(e.code).setData(e.data).setMsg(e.msg).setRetriable(e.retriable)}code;msg;data;retriable;constructor(e,t,n,a){this.code=e,this.data=t,this.msg=n,this.retriable=a}getCode(){return this.code}setCode(e){return this.code=e,this}getData(){return this.data}setData(e){return this.data=e,this}getMsg(){return this.msg}setMsg(e){return this.msg=e,this}getRetriable(){return this.retriable}setRetriable(e){return this.retriable=e,this}}var o=n(15338);function s(){const{siteConfig:e}=(0,o.A)(),t=e.customFields.apiUrl;return async function(){const e=localStorage.getItem("x-token");for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];"string"==typeof a[0]&&(a[0]=t+a[0]),a[1]??={},a[1].headers??={},a[1].headers["Content-Type"]="application/json",e&&(a[1].headers.Authorization=`Bearer ${e}`),a[1].body=JSON.stringify(a[1].body);const s=await fetch(...a),l=r.from(await s.json());if(0===l.getCode())return l.getData();i.Ay.error(l.getMsg())}}}}]);